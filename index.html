<!DOCTYPE html>
<html lang="zh-Hant" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç¦å²¡ 2025 æ¥“è‘‰è³¼ç‰©ä¹‹æ—…</title>
    <!-- 
      Travel Blueprint v24
      Generated by AI Web Designer
      Data: Fukuoka 2025
      Update: Day 3 Plan B (Dazaifu) & JR Transport
    -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* åš´æ ¼éµå¾ªè—åœ– 2.3.3 è¦æ ¼ 
        */

        /* éš±è—æ»¾å‹•æ¢ */
        .hide-scrollbar {
            -ms-overflow-style: none; /* IE and Edge */
            scrollbar-width: none; /* Firefox */
        }
        .hide-scrollbar::-webkit-scrollbar {
            display: none; /* Chrome, Safari, Opera */
        }

        /* é é¢åˆ‡æ›æ•ˆæœ */
        .page {
            transition: transform 0.3s ease-in-out;
        }
        .page-hidden {
            transform: translateX(100%);
        }
        .page-visible {
            transform: translateX(0);
        }

        /* åš´æ ¼éµå¾ªè—åœ– 2.3.3 è¦æ ¼: Timeline Item */
        .timeline-item::before {
            content: '';
            position: absolute;
            left: 1.125rem; /* 4.5 * 0.25rem = 18px */
            top: 1.25rem; /* 20px */
            bottom: -0.5rem; /* -8px */
            width: 2px;
            background-color: #374151; /* gray-700 */
        }
        /* æœ€å¾Œä¸€å€‹ timeline-item ä¸é¡¯ç¤ºç·šæ¢ */
        .timeline-item:last-child::before {
            display: none;
        }
        /* è—åœ– 2.3.3 è¦æ ¼: æ™‚é–“è»¸è—é» */
        .timeline-dot {
            width: 1rem; /* w-4 */
            height: 1rem; /* h-4 */
            background-color: #3b82f6; /* bg-blue-500 */
            border-radius: 9999px; /* rounded-full */
            border-width: 4px; /* border-4 */
            border-color: #1f2937; /* border-gray-800 */
            position: absolute;
            left: 0.625rem; /* 10px */
            top: 1.25rem; /* 20px */
            z-index: 10;
        }

        /* åš´æ ¼éµå¾ªè—åœ– 2.3.3 è¦æ ¼: åŠ è¼‰å‹•ç•« */
        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
        .loader-small {
            width: 1rem;
            height: 1rem;
            border: 2px solid #4b5563; /* border-gray-600 */
            border-top-color: #3b82f6; /* blue-500 */
            border-radius: 50%;
            animation: spin 0.6s linear infinite;
        }
        .gemini-loader {
            width: 1.5rem; /* w-6 */
            height: 1.5rem; /* h-6 */
            border: 3px solid #4b5563; /* border-gray-600 */
            border-top-color: #818cf8; /* indigo-400 */
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
    </style>
</head>
<body class="bg-gray-900 text-gray-100">

    <!-- 
      åš´æ ¼éµå¾ªè—åœ– 2.3.3 è¦æ ¼: App å®¹å™¨ 
    -->
    <div id="app-container" class="relative h-screen w-full max-w-lg mx-auto bg-gray-800 overflow-hidden shadow-2xl flex flex-col">

        <!-- 
          åš´æ ¼éµå¾ªè—åœ– 2.3.3 è¦æ ¼: ä¸»é åŒ…è¦†å™¨
        -->
        <div id="main-page-wrapper" class="flex flex-col flex-grow h-full">
            
            <!-- 
              åš´æ ¼éµå¾ªè—åœ– 2.3.3 è¦æ ¼: é ‚éƒ¨æ¨™é¡Œ 
            -->
            <header class="flex-shrink-0 bg-gray-800/80 backdrop-blur-sm z-20 px-4 sm:px-6 py-4 border-b border-gray-700 flex items-center justify-center">
                <h1 id="app-title" class="text-xl font-bold text-gray-100"></h1>
            </header>

            <!-- 
              åš´æ ¼éµå¾ªè—åœ– 2.3.3 è¦æ ¼: ä¸»å…§å®¹å€ 
            -->
            <main class="flex-grow overflow-y-auto p-6 hide-scrollbar">
                
                <!-- 1. è¡Œç¨‹è¦–åœ– -->
                <section id="itinerary-view" class="space-y-4">
                    <!-- è¡Œç¨‹å¡ç‰‡å°‡ç”± JS å‹•æ…‹æ’å…¥æ­¤è™• -->
                </section>

                <!-- 2. ç¾é£Ÿè¦–åœ– -->
                <section id="foodie-view" class="hidden space-y-6">
                    <!-- AI ç¾é£Ÿå»ºè­°å€ -->
                    <div id="ai-foodie-container" class="relative bg-gray-900/50 rounded-lg p-4 border border-gray-700">
                        <div class="flex items-center justify-between mb-3">
                            <h3 class="text-base font-semibold text-indigo-300">AI æ™ºèƒ½ç¾é£Ÿæ¨è–¦</h3>
                            <button id="gemini-button" class="p-1 rounded-full hover:bg-gray-700 active:bg-gray-600">
                                <!-- åˆå§‹åœ–ç¤º (å°‡ç”± JS æ›¿æ›) -->
                            </button>
                        </div>
                        <p id="ai-status-text" class="text-xs text-gray-400">é»æ“Šå³æ–¹æŒ‰éˆ•ï¼ŒAI å°‡æ ¹æ“šæ‚¨çš„è¡Œç¨‹æ¨è–¦ä»Šæ—¥é™„è¿‘ç¾é£Ÿ (è«‹å…ˆåœ¨ Config ä¸­è¨­å®š API Key)ã€‚</p>
                        <div id="ai-foodie-list" class="mt-4 space-y-4">
                            <!-- AI æ¨è–¦å¡ç‰‡å°‡æ’å…¥æ­¤è™• -->
                        </div>
                    </div>
                    
                    <!-- é å­˜ç¾é£Ÿæ¸…å–® -->
                    <div id="saved-foodie-list" class="space-y-6">
                        <!-- ç¾é£Ÿå¡ç‰‡å°‡ç”± JS å‹•æ…‹æ’å…¥æ­¤è™• -->
                    </div>
                </section>

                <!-- 3. å„ªæƒ åˆ¸è¦–åœ– -->
                <section id="coupon-view" class="hidden space-y-6">
                    <div id="coupon-list-container">
                        <!-- å„ªæƒ åˆ¸åˆ†é¡å’Œå¡ç‰‡å°‡ç”± JS å‹•æ…‹æ’å…¥æ­¤è™• -->
                    </div>
                    
                    <!-- åš´æ ¼éµå¾ªè—åœ– 2.3.4 (åŠŸèƒ½ 5) è¦æ ¼: ä¾†æºé€£çµ -->
                    <div class="text-center mt-6">
                        <p class="text-xs text-gray-500">
                            Source from : 
                            <a href="https://www.funtime.com.tw/blog/funtime/japan-coupon" target="_blank" rel="noopener noreferrer" class="underline hover:text-gray-400">
                                FunTime
                            </a>
                        </p>
                    </div>
                </section>

            </main>

            <!-- 
              åš´æ ¼éµå¾ªè—åœ– 2.3.3 è¦æ ¼: åº•éƒ¨å°è¦½åˆ—
            -->
            <nav class="flex-shrink-0 bg-gray-800/90 backdrop-blur-sm border-t border-gray-700">
                <div class="flex justify-around items-center h-16">
                    <button class="nav-button flex flex-col items-center justify-center w-full h-full text-blue-400" data-view="itinerary-view">
                        <div class="icon-container w-6 h-6"></div>
                        <span class="text-xs mt-1">è¡Œç¨‹</span>
                    </button>
                    <button class="nav-button flex flex-col items-center justify-center w-full h-full text-gray-400" data-view="foodie-view">
                        <div class="icon-container w-6 h-6"></div>
                        <span class="text-xs mt-1">ç¾é£Ÿ</span>
                    </button>
                    <button class="nav-button flex flex-col items-center justify-center w-full h-full text-gray-400" data-view="coupon-view">
                        <div class="icon-container w-6 h-6"></div>
                        <span class="text-xs mt-1">å„ªæƒ åˆ¸</span>
                    </button>
                </div>
            </nav>
        </div>

        <!-- 
          åš´æ ¼éµå¾ªè—åœ– 2.3.3 è¦æ ¼: è©³æƒ…é 
        -->
        <div id="detail-page" class="page page-hidden absolute inset-0 bg-gray-800 z-30 flex flex-col">
            <!-- 
              è©³æƒ…é é ‚æ¬„ (ç”± JS å‹•æ…‹ç”Ÿæˆ)
              åš´æ ¼éµå¾ªè—åœ– 2.3.4 (åŠŸèƒ½ 2) è¦æ ¼
            -->
            <header id="detail-header" class="flex-shrink-0 bg-gray-800/80 backdrop-blur-sm z-20 px-4 sm:px-6 py-4 border-b border-gray-700 flex items-center">
                <!-- JS Will populate this -->
            </header>

            <!-- è©³æƒ…é å…§å®¹ -->
            <main id="detail-content" class="flex-grow overflow-y-auto p-6 hide-scrollbar">
                <!-- æ™‚é–“è»¸å°‡ç”± JS å‹•æ…‹æ’å…¥æ­¤è™• -->
            </main>
        </div>

    </div>

    <!-- 
      åš´æ ¼éµå¾ªè—åœ– 2.3.3 (BUG ä¿®æ­£) è¦æ ¼: å½ˆçª— (é è¨­ hidden)
    -->
    <div id="coupon-modal" class="hidden fixed inset-0 z-50 flex items-center justify-center bg-black/80 p-4">
        <div class="bg-gray-700 rounded-lg shadow-xl w-full max-w-lg max-h-[90vh] flex flex-col">
            <div class="flex justify-between items-center p-4 border-b border-gray-600">
                <h3 id="modal-title" class="text-lg font-semibold text-white">å„ªæƒ åˆ¸è©³æƒ…</h3>
                <button id="modal-close-button" class="text-gray-400 hover:text-white">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>
                </button>
            </div>
            <div class="p-4 overflow-y-auto">
                <img id="modal-image" src="" alt="Coupon Image" class="w-full h-auto rounded">
            </div>
        </div>
    </div>

    <!-- 
      ============================================================
      TEMPLATES (åš´æ ¼éµå¾ªè—åœ– 2.3.2 & 2.3.5 è¦æ ¼)
      ============================================================
    -->

    <!-- 
      è—åœ– 2.3.5: #template-itinerary-card (è¡Œç¨‹å¡ç‰‡) 
    -->
    <template id="template-itinerary-card">
        <div class="card bg-gray-900/50 rounded-lg shadow-md overflow-hidden cursor-pointer hover:bg-gray-900 transition-colors duration-150 border border-gray-700">
            <div class="p-5">
                <div class="flex justify-between items-start">
                    <!-- å·¦å´ -->
                    <div class="flex-grow">
                        <!-- ç¬¬ä¸€è¡Œ (Day/Date) -->
                        <div class="flex items-baseline gap-2">
                            <span class="text-xl font-bold text-blue-400" data-text="day"></span>
                            <span class="text-sm text-gray-400" data-text="date"></span>
                            <div class="note-icon-container">
                                <!-- éˆ´éºåœ–ç¤º (JS) -->
                            </div>
                        </div>
                        <!-- ç¬¬äºŒè¡Œ (Theme) -->
                        <h3 class="text-lg font-bold mt-1 text-gray-100" data-text="theme"></h3>
                    </div>
                    <!-- å³å´: å¤©æ°£å®¹å™¨ -->
                    <div class="weather-container w-12 h-10 flex items-center justify-center flex-shrink-0 text-center">
                        <div class="loader-small"></div>
                    </div>
                </div>
            </div>
        </div>
    </template>

    <!-- 
      è—åœ– 2.3.5: #template-foodie-card (ç¾é£Ÿå¡ç‰‡) 
    -->
    <template id="template-foodie-card">
        <div class="card bg-gray-900/50 rounded-lg p-4 border border-gray-700">
            <div class="flex items-center justify-between">
                <!-- å·¦å´ -->
                <div class="flex-grow pr-4 overflow-hidden">
                    <div class="flex items-baseline gap-3 flex-wrap">
                        <h4 class="text-lg font-semibold text-gray-100 truncate" data-text="name"></h4>
                        <span class="text-sm text-cyan-400 bg-cyan-900/50 px-2 py-0.5 rounded-full" data-text="tag"></span>
                        <div class="ai-badge">
                            <!-- AI æ¨™ç±¤ (JS) -->
                        </div>
                    </div>
                </div>
                <!-- å³å´: åœ°åœ–é€£çµ -->
                <a href="#" target="_blank" rel="noopener noreferrer" class="map-link flex-shrink-0 w-12 h-12 flex items-center justify-center rounded-full bg-slate-600 hover:bg-slate-500 transition-colors">
                    <!-- åœ–ç¤º (JS) -->
                </a>
            </div>
        </div>
    </template>

    <!-- 
      è—åœ– 2.3.5: #template-coupon-card (å„ªæƒ åˆ¸å¡ç‰‡) 
    -->
    <template id="template-coupon-card">
        <div class="card bg-gray-900/50 rounded-lg shadow-md overflow-hidden cursor-pointer hover:bg-gray-900 transition-colors duration-150 border border-gray-700 flex flex-col h-full">
            <div class="p-4 flex-grow flex flex-col pointer-events-none">
                <h4 class="text-base font-semibold text-gray-100" data-text="name"></h4>
                <p class="text-sm text-yellow-300 mt-1 flex-grow" data-text="discount"></p>
                <!-- åº•éƒ¨ -->
                <div class="flex justify-between items-center text-xs text-gray-400 mt-3">
                    <span data-text="expiry"></span>
                    <div class="link-icon-container w-5 h-5 text-gray-300">
                        <!-- åœ–ç¤º (JS) -->
                    </div>
                </div>
            </div>
        </div>
    </template>

    <!-- 
      è—åœ– 2.3.5: #template-timeline-item (æ™‚é–“è»¸é …ç›®) 
    -->
    <template id="template-timeline-item">
        <div class="timeline-item relative pl-10 pb-14">
            <!-- åš´æ ¼éµå¾ªè—åœ– 2.3.3: è—é»åœ–ç¤º -->
            <div class="timeline-dot"></div>
            
            <span class="text-sm font-semibold text-blue-400" data-text="time"></span>
            <h4 class="text-lg font-bold text-gray-100 mt-1" data-text="title"></h4>
            <p class="text-sm text-gray-300 mt-2" data-text="description"></p>
            
            <!-- 
              åš´æ ¼éµå¾ªè—åœ– 2.3.5: æé†’æ¡† (Notes Container) 
              å¿…é ˆæ”¾ç½®åœ¨ description å’Œ buttons ä¹‹é–“
            -->
            <div class="notes-container hidden mt-4">
                <div class="bg-yellow-900/30 border-l-4 border-yellow-400 p-3 rounded-r-md">
                    <div class="flex items-start">
                        <div class="flex-shrink-0 w-5 h-5 text-yellow-400">
                            <!-- è­¦ç¤ºåœ–ç¤º (JS) -->
                        </div>
                        <div class="ml-2 flex-grow">
                            <h5 class="text-sm font-semibold text-yellow-300">é‡è¦æé†’</h5>
                            <div class="notes-content text-sm text-yellow-200 mt-1 space-y-1">
                                <!-- æé†’å…§å®¹ (JS) -->
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- 
              åš´æ ¼éµå¾ªè—åœ– 2.3.5: æŒ‰éˆ•å®¹å™¨ 
            -->
            <div class="flex items-center gap-2 mt-4">
                <!-- 
                  åš´æ ¼éµå¾ªè—åœ– 2.3.5: äº¤é€šæŒ‰éˆ• (transport-link) 
                -->
                <a href="#" target="_blank" rel="noopener noreferrer" class="transport-link inline-flex items-center gap-2 bg-slate-600 hover:bg-slate-500 text-gray-200 px-3 py-2 rounded-md text-sm transition-colors">
                    <div class="w-5 h-5 flex-shrink-0">
                        <!-- tram-front åœ–ç¤º (JS) -->
                    </div>
                    <span class="transport-text flex-shrink min-w-0" data-text="transport"></span>
                    <div class="w-5 h-5 flex-shrink-0">
                        <!-- map-pin åœ–ç¤º (JS) -->
                    </div>
                </a>
                
                <!-- 
                  åš´æ ¼éµå¾ªè—åœ– 2.3.5: å¤–éƒ¨é€£çµæŒ‰éˆ• (external-link-container) 
                -->
                <div class="external-link-container">
                    <!-- ç¨ç«‹çš„ç¶ è‰²é€£çµæŒ‰éˆ• (JS) -->
                </div>
            </div>
        </div>
    </template>

    <!-- 
      ============================================================
      JAVASCRIPT (åš´æ ¼éµå¾ªè—åœ– 2.3.1, 2.3.4 è¦æ ¼)
      ============================================================
    -->
    <script>
        // åš´æ ¼éµå¾ªè—åœ– 2.3.1 è¦æ ¼: config ç‰©ä»¶
        const config = {
            api: {
                weather: {
                    forecast: "https://api.open-meteo.com/v1/forecast",
                    archive: "https://archive-api.open-meteo.com/v1/archive"
                },
                gemini: {
                    url: "https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent", // ä½¿ç”¨ 1.5-flash
                    apiKey: "" // æé†’ï¼šä½¿ç”¨è€…éœ€è‡ªè¡Œå¡«å…¥ API Key æ‰èƒ½ä½¿ç”¨ AI ç¾é£ŸåŠŸèƒ½
                }
            },
            categories: {
                coupons: {
                    order: ["é›»å™¨", "è—¥å¦", "ç™¾è²¨", "ç¶œåˆ/å…ç¨…", "å…¶ä»–"],
                    icons: { "é›»å™¨": "plug-zap", "è—¥å¦": "pilcrow", "ç™¾è²¨": "shopping-bag", "ç¶œåˆ/å…ç¨…": "gem", "å…¶ä»–": "shopping-cart" }
                },
                foodie: {
                    // AI å¿…é ˆæ ¹æ“šæ–°è¡Œç¨‹çš„ä¸»è¦åŸå¸‚æ›´æ–°æ­¤åˆ—è¡¨
                    regionOrder: ["ç¦å²¡", "Sasaguri", "Dazaifu"]
                }
            },
            // åš´æ ¼éµå¾ªè—åœ– 2.3.1 è¦æ ¼:
            // æ›´æ–°ï¼šæ ¹æ“šç”¨æˆ¶ç•¶å‰æ™‚é–“ (2025-11-16 19:50 JST) è¨­ç½®æ¨¡æ“¬æ—¥æœŸ
            // é€™ç¢ºä¿äº† 11/17 è¡Œç¨‹åœ¨é å ±ç¯„åœå…§ï¼Œä¸æœƒé¡¯ç¤º * è™Ÿ
            simulationDate: new Date('2025-11-16T19:50:00+09:00') 
        };

        // åš´æ ¼éµå¾ªè—åœ– 2.3.1 è¦æ ¼: tripData ç‰©ä»¶
        // AI å·²è‡ªå‹•è¦åŠƒè¡Œç¨‹ã€æœé›†è³‡æ–™ã€å¡«å……ç¾é£Ÿã€åˆ†é¡å„ªæƒ åˆ¸
        const tripData = {
            "tripTitle": "ç¦å²¡ 2025 æ¥“è‘‰è³¼ç‰©ä¹‹æ—…",
            // è—åœ– 2.2.4: AI å¿…é ˆè‡ªå‹•å¡«å……ç¶“ç·¯åº¦
            "locations": {
                "ç¦å²¡": { "lat": 33.5904, "lon": 130.4017 },
                "Sasaguri": { "lat": 33.6380, "lon": 130.5230 },
                "Dazaifu": { "lat": 33.5196, "lon": 130.5338 }
            },
            // è—åœ– 2.2.2: AI å¿…é ˆè‡ªå‹•è¦åŠƒä¸¦å¡«å…¥æ¯æ—¥çš„è©³ç´°è¡Œç¨‹
            "itinerary": [
                { 
                  "day": 1, 
                  "date": "2025-11-17", 
                  "theme": "æŠµé”ç¦å²¡ & å¤©ç¥è³¼ç‰©å¤œ", 
                  "location": "ç¦å²¡", 
                  "activities": [ 
                    { 
                      "time": "15:10", 
                      "title": "æŠµé”ç¦å²¡æ©Ÿå ´ (FUK)", 
                      "description": "èˆªç­ UO668ã€‚æº–å‚™å¥½å…¥å¢ƒã€é ˜å–è¡Œæã€‚", 
                      "transport": "å¾ç¦å²¡æ©Ÿå ´åœ‹éš›ç·šèˆªå»ˆæ­ä¹˜å…è²»æ¥é§å·´å£«è‡³åœ‹å…§ç·šèˆªå»ˆï¼Œè½‰ä¹˜ã€Œåœ°éµç©ºæ¸¯ç·šã€å‰å¾€ã€Œå¤©ç¥ç«™ã€ã€‚(ç¸½ç¨‹ç´„ 20 åˆ†é˜)",
                      "mapLink": "https://maps.google.com/maps?q=Fukuoka+Airport",
                      "notes": ["æ©Ÿå ´åœ°éµç«™ä½æ–¼åœ‹å…§ç·šèˆªå»ˆï¼Œéœ€æ­ä¹˜å…è²»æ¥é§è»Šã€‚"], 
                      "link": "https://www.fukuoka-airport.jp/chinese-trad/" 
                    },
                    { 
                      "time": "17:00", 
                      "title": "Check-in & Bic Camera", 
                      "description": "è¾¦ç†å…¥ä½å¾Œï¼Œå‰å¾€ã€ŒBic Camera å¤©ç¥é¤¨ã€æ¡è³¼é›»å™¨å’Œè—¥å¦ã€‚æ‚¨æ‰‹ä¸Šæœ‰ Bic Camera å„ªæƒ åˆ¸ï¼Œè²·å¹é¢¨æ©Ÿã€è—¥å¦éƒ½å¾ˆåˆ’ç®—ã€‚", 
                      "transport": "ä½æ–¼å¤©ç¥è­¦å›ºç¥ç¤¾é™„è¿‘ï¼Œæ­¥è¡Œå³å¯æŠµé”ã€‚",
                      "mapLink": "https://maps.google.com/maps?q=Bic+Camera+Tenjin+2nd+Building",
                      "notes": ["è¨˜å¾—å‡ºç¤º App å…§çš„å„ªæƒ åˆ¸ã€‚", "å…±æœ‰ 1 è™Ÿé¤¨å’Œ 2 è™Ÿé¤¨ï¼Œ2 è™Ÿé¤¨ä¸»è¦è³£é›»å™¨å’Œæ•¸ä½ç”¢å“ã€‚"], 
                      "link": "https://www.biccamera.com/bc/i/shop/shoplist/shop118.jsp"
                    },
                    { 
                      "time": "19:00", 
                      "title": "ç¦å²¡ Parco (å‹•æ¼« & æ½®æµ)", 
                      "description": "å°±åœ¨ Bic Camera é™„è¿‘ï¼Œå¹´è¼•äººå¿…é€›ï¼æœ‰ã€ŒONE PIECE éº¥ã‚ã‚‰ã‚¹ãƒˆã‚¢ã€å°ˆè³£åº—ã€å‰åœåŠ›å…±å’Œåœ‹ï¼Œä»¥åŠè¨±å¤šæµè¡Œçš„æœé£¾é›œè²¨ã€‚", 
                      "transport": "å¤©ç¥åœ°éµç«™ç›´çµï¼Œæ­¥è¡Œ 2 åˆ†é˜ã€‚",
                      "mapLink": "https://maps.google.com/maps?q=Fukuoka+Parco",
                      "notes": ["å•†åº—é€šå¸¸ç‡Ÿæ¥­è‡³ 20:30ï¼Œé¤å»³å±¤è‡³ 23:00ã€‚", "å‹•æ¼«åº—é›†ä¸­åœ¨ 7-8 æ¨“ã€‚"], 
                      "link": "https://fukuoka.parco.jp/"
                    },
                    { 
                      "time": "20:30", 
                      "title": "æ™šé¤ï¼šå¤©ç¥ç‡’è‚‰ (æ»¿è¶³éœ€æ±‚)", 
                      "description": "åœ¨å¤©ç¥å‘¨é‚Šäº«ç”¨ç¾å‘³çš„æ—¥å¼ç‡’è‚‰ï¼Œæ…°å‹ç¬¬ä¸€å¤©çš„å¥”æ³¢ã€‚", 
                      "transport": "æ­¥è¡Œå‰å¾€é¤å»³ã€‚",
                      "mapLink": "https://maps.google.com/maps?q=Yakiniku+Tenjin",
                      "notes": ["å»ºè­°æå‰é è¨‚ç†±é–€ç‡’è‚‰åº—ï¼Œå¦‚ã€ŒBakuroã€æˆ–ã€ŒNikuichiã€ã€‚"], 
                      "link": null
                    }
                  ] 
                },
                { 
                  "day": 2, 
                  "date": "2025-11-18", 
                  "theme": "æµ·ä¹‹ä¸­é“ & Mina å¤©ç¥", 
                  "location": "ç¦å²¡", 
                  "activities": [ 
                    { 
                      "time": "ä¸Šåˆ (09:30)", 
                      "title": "å‰å¾€ã€Œæµ·ä¹‹ä¸­é“ã€", 
                      "description": "å‡ºç™¼å‰å¾€æµ·ä¹‹ä¸­é“æµ·æ¿±å…¬åœ’åŠæµ·æ´‹ä¸–ç•Œæ°´æ—é¤¨ã€‚", 
                      "transport": "å¾ã€Œåšå¤šç«™ã€æ­ä¹˜ JR é¹¿å…’å³¶æœ¬ç·šè‡³ã€Œé¦™æ¤ç«™ã€ï¼Œè½‰ä¹˜ JR é¦™æ¤ç·šè‡³ã€Œæµ·ä¹‹ä¸­é“ç«™ã€ã€‚(ç¸½ç¨‹ç´„ 40-50 åˆ†é˜)",
                      "mapLink": "https://maps.google.com/maps?q=Uminonakamichi+Station",
                      "notes": ["ä¹Ÿå¯ä»¥å¾åšå¤šç¢¼é ­æ­èˆ¹å‰å¾€ï¼Œé¢¨æ™¯ä¸åŒä½†ç¥¨åƒ¹è¼ƒé«˜ã€‚", "è«‹ç¢ºèª JR é¦™æ¤ç·šçš„ç­æ¬¡ã€‚"], 
                      "link": "https://www.jrkyushu.co.jp/" 
                    },
                    { 
                      "time": "ä¸Šåˆ (10:30)", 
                      "title": "æµ·æ´‹ä¸–ç•Œ (Marine World)", 
                      "description": "åƒè§€ã€Œæµ·æ´‹ä¸–ç•Œã€æ°´æ—é¤¨ï¼Œæ¬£è³ç²¾å½©çš„æµ·è±šèˆ‡æµ·ç…è¡¨æ¼”ï¼Œä»¥åŠä¹å·è¿‘æµ·çš„è±å¯Œæµ·æ´‹ç”Ÿç‰©ã€‚", 
                      "transport": "å¾ã€Œæµ·ä¹‹ä¸­é“ç«™ã€æ­¥è¡Œç´„ 5-10 åˆ†é˜ã€‚",
                      "mapLink": "https://maps.google.com/maps?q=Marine+World+Uminonakamichi",
                      "notes": ["è«‹å…ˆæŸ¥å¥½æµ·è±šè¡¨æ¼”çš„æ™‚é–“è¡¨ï¼Œä»¥å…éŒ¯éã€‚"], 
                      "link": "https://marine-world.jp/zh-tw/"
                    },
                    { 
                      "time": "ä¸‹åˆ (13:30)", 
                      "title": "æµ·ä¹‹ä¸­é“æµ·æ¿±å…¬åœ’ (è³èŠ±)", 
                      "description": "åœ¨å»£é—Šçš„æµ·æ¿±å…¬åœ’å…§äº«ç”¨åˆé¤ï¼Œä¸¦ç§Ÿå€Ÿè‡ªè¡Œè»Šã€‚11æœˆæ˜¯ç§‹å­£èŠ±å‰ï¼ˆå¦‚ç²‰é»›äº‚å­è‰ã€ç§‹æ«»ï¼‰çš„å°¾è²ï¼Œä»å¯äº«å—é¨è¡Œæ¨‚è¶£ã€‚", 
                      "transport": "æ°´æ—é¤¨æ—é‚Šå³æ˜¯å…¬åœ’å…¥å£ã€‚",
                      "mapLink": "https://maps.google.com/maps?q=Uminonakamichi+Seaside+Park",
                      "notes": ["å…¬åœ’éå¸¸å¤§ï¼Œå¼·çƒˆå»ºè­°ç§Ÿå€Ÿè‡ªè¡Œè»Šã€‚", "èŠ±æ³å—å¤©æ°£å½±éŸ¿ï¼Œ11æœˆä¸­å¯èƒ½ä¸å¦‚ç››é–‹æœŸã€‚"], 
                      "link": "https://uminonakamichi-park.jp/zh-cn/"
                    },
                    { 
                      "time": "å‚æ™š (17:30)", 
                      "title": "Mina å¤©ç¥ (å¹³åƒ¹è³¼ç‰©)", 
                      "description": "å‰å¾€å¹´è¼•äººå¿…é€›çš„ã€ŒMina å¤©ç¥ã€ã€‚é€™è£¡æœ‰ä¹å·æœ€å¤§çš„ UNIQLOã€GU å’Œ Loftï¼Œé‚„æœ‰ç™¾å…ƒåº— Seriaï¼Œåƒ¹æ ¼è¦ªæ°‘ï¼Œä¸€æ¬¡è²·é½Šæ½®æµæœé£¾èˆ‡é›œè²¨ã€‚", 
                      "transport": "å¾ªåŸè·¯æ­ä¹˜ JR è¿”å›ã€Œåšå¤šç«™ã€ï¼Œå†è½‰ä¹˜åœ°éµè‡³ã€Œå¤©ç¥ç«™ã€ï¼Œæ­¥è¡Œ 3 åˆ†é˜ã€‚",
                      "mapLink": "https://maps.google.com/maps?q=Mina+Tenjin",
                      "notes": ["æ•´æ£Ÿéƒ½æ˜¯å¹´è¼•å¹³åƒ¹å“ç‰Œï¼Œéå¸¸å¥½é€›ã€‚", "å¯ä»¥è¾¦ç†å…ç¨…ã€‚"], 
                      "link": "https://www.mina-tenjin.com/"
                    }
                  ] 
                },
                { 
                  "day": 3, 
                  "date": "2025-11-19", 
                  "theme": "å‘‘å±±è§€éŸ³å¯º & ç™¾é“è³¼ç‰©è¶£", 
                  "location": "Sasaguri", 
                  "activities": [ 
                    { 
                      "time": "ä¸Šåˆ (09:00)", 
                      "title": "å‰å¾€ã€Œå‘‘å±±è¦³éŸ³å¯ºã€", 
                      "description": "å‡ºç™¼å‰å¾€ç¦å²¡è‘—åçš„ç´…è‘‰åæ‰€ã€Œå‘‘å±±è§€éŸ³å¯ºã€ã€‚é¸æ“‡æ­ä¹˜ JR å¿«é€Ÿé›»è»Šï¼Œå¿«é€Ÿä¾¿æ·åœ°å‰å¾€ã€‚", 
                      "transport": "å¾ã€Œåšå¤šç«™ã€æ­ä¹˜ JR ç¦åŒ—è±è·¯é€ç·š (å¿«é€Ÿ) è‡³ã€Œç¯ æ —ç«™ã€(ç´„ 15 åˆ†é˜)ï¼Œå‡ºç«™å¾Œè½‰ä¹˜è¨ˆç¨‹è»Šè‡³å¯ºå»Ÿ (ç´„ 15 åˆ†é˜)ã€‚",
                      "mapLink": "https://maps.google.com/maps?q=Nomiyama+Kannonji+Temple",
                      "notes": ["è³æ¥“å­£ç¯€äººå¤šï¼Œè¨ˆç¨‹è»Šæ˜¯æœ€å¯é çš„é¸æ“‡ã€‚", "å»ºè­°å‘å¸æ©Ÿç´¢å–é›»è©±ï¼Œå›ç¨‹å¯å«è»Šã€‚"], 
                      "link": "https://www.nomiyamakannonji.com/" 
                    },
                    { 
                      "time": "ä¸­åˆ", 
                      "title": "æ¼«æ­¥ç´…è‘‰åƒé“ & ç‘œç¥‡å¤§å¯¶å¡”", 
                      "description": "æ¬£è³å¢ƒå…§å£¯è§€çš„ç´…è‘‰ï¼Œç‰¹åˆ¥æ˜¯å¤©ç‹é™¢å‘¨é‚Šçš„ã€ŒåŠé˜èŠ±ï¼ˆãƒ‰ã‚¦ãƒ€ãƒ³ãƒ„ãƒ„ã‚¸ï¼‰ã€éš§é“ï¼Œæ•´ç‰‡ç«ç´…éå¸¸éœ‡æ’¼ã€‚", 
                      "transport": "æ­¥è¡Œæ¢ç´¢ã€‚",
                      "mapLink": "https://maps.google.com/maps?q=Nomiyama+Kannonji+Autumn+Leaves",
                      "notes": ["å±±å€æ°£æº«è¼ƒä½ï¼Œè«‹å¤šå¸¶ä¸€ä»¶å¤–å¥—ã€‚", "å¢ƒå…§æœ‰è¨±å¤šéšæ¢¯ï¼Œå»ºè­°ç©¿è‘—èˆ’é©çš„é‹å­ã€‚"], 
                      "link": null
                    },
                    { 
                      "time": "ä¸‹åˆ", 
                      "title": "å‰å¾€ç™¾é“ (Momochi) åœ°å€", 
                      "description": "é›¢é–‹ç¯ æ —ï¼Œå‰å¾€æµ·æ¿±çš„ç™¾é“åœ°å€ï¼Œæº–å‚™åƒè§€ä¾¿ä¾¿å±•ã€‚", 
                      "transport": "æ­è¨ˆç¨‹è»Šå›ã€Œç¯ æ —ç«™ã€ï¼Œè½‰ JR è‡³ã€Œåšå¤šç«™ã€ï¼Œå†å¾åšå¤šå·´å£«ç¸½ç«™æ­ä¹˜ã€Œ306ã€è™Ÿå·´å£«è‡³ã€ŒPayPayå·¨è›‹å‰ã€ã€‚",
                      "mapLink": "https://maps.google.com/maps?q=PayPay+Dome",
                      "notes": [], 
                      "link": null
                    },
                    { 
                      "time": "å‚æ™š (17:00)", 
                      "title": "MARK IS ç¦å²¡ç™¾é“ (å¥½é€›!)", 
                      "description": "åœ¨ä¾¿ä¾¿å±•æ—é‚Šçš„è¶…å¤§å•†å ´ï¼é€™è£¡éå¸¸å¯¬æ•èˆ’é©ï¼Œæœ‰ ABC-Mart Grand Stage, Uniqlo, Nitori ä»¥åŠå¾ˆå¤šå¹´è¼•ä¼‘é–’å“ç‰Œï¼Œéå¸¸å¥½é€›ã€‚", 
                      "transport": "å°±åœ¨ E-ZO FUKUOKA éš”å£ï¼Œæ­¥è¡Œ 1 åˆ†é˜ã€‚",
                      "mapLink": "https://maps.google.com/maps?q=MARK+IS+Fukuoka+Momochi",
                      "notes": ["æ¨è–¦é€™è£¡çš„è¶…å¸‚ï¼Œç†Ÿé£Ÿé¸æ“‡å¾ˆå¤šã€‚", "Awesome Store æœ‰å¾ˆå¤šä¾¿å®œå¯æ„›çš„é›œè²¨ã€‚"], 
                      "link": "https://www.mec-markis.jp/fukuoka-momochi/"
                    },
                    { 
                      "time": "æ™šä¸Š (19:00)", 
                      "title": "ç¦å²¡ä¾¿ä¾¿å±• (Unko Museum)", 
                      "description": "å°±åœ¨éš”å£çš„ BOSS Eãƒ»ZO FUKUOKAï¼Œé«”é©—æœ‰è¶£åˆå¥½æ‹çš„ã€Œç¦å²¡ä¾¿ä¾¿å±•ã€ã€‚E-ZO è£¡é¢é‚„æœ‰ TeamLab Forest (å¦‚æœæœ‰æ™‚é–“çš„è©±)ã€‚", 
                      "transport": "æ­¥è¡Œ 1 åˆ†é˜ã€‚",
                      "mapLink": "https://maps.google.com/maps?q=BOSS+Eãƒ»ZO+FUKUOKA",
                      "notes": ["å±•è¦½é€šå¸¸ç‡Ÿæ¥­è‡³ 20:00 (æœ€å¾Œå…¥å ´ 19:30)ï¼Œè«‹æ³¨æ„æ™‚é–“ã€‚", "å¯ä»¥åœ¨ E-ZO æˆ– MARK IS äº«ç”¨æ™šé¤ã€‚"], 
                      "link": "https://e-zofukuoka.com/unko-museum/"
                    }
                  ],
                  "planB": {
                    "theme": "å¤ªå®°åºœ & ç«ˆé–€ç¥ç¤¾ (Plan B)",
                    "location": "Dazaifu",
                    "activities": [
                        {
                            "time": "ä¸Šåˆ (09:30)",
                            "title": "å‰å¾€ã€Œå¤ªå®°åºœå¤©æ»¿å®®ã€",
                            "description": "Plan Bï¼šå‰å¾€ç¦å²¡æœ€è‘—åçš„æ™¯é»ã€‚æ­ä¹˜è¥¿éµé›»è»Šå‰å¾€å¤ªå®°åºœã€‚",
                            "transport": "å¾ã€Œè¥¿éµç¦å²¡(å¤©ç¥)ç«™ã€æ­ä¹˜å¤§ç‰Ÿç”°ç·šè‡³ã€Œè¥¿éµäºŒæ—¥å¸‚ç«™ã€ï¼Œè½‰ä¹˜å¤ªå®°åºœç·šè‡³ã€Œå¤ªå®°åºœç«™ã€ã€‚(ç¸½ç¨‹ç´„ 30-40 åˆ†é˜)",
                            "mapLink": "https://maps.google.com/maps?q=Dazaifu+Station",
                            "notes": ["å¦‚é‡ä¸Šç›´é”åˆ—è»Šã€Œæ—…äººè™Ÿã€å‰‡ç„¡éœ€è½‰ä¹˜ã€‚", "å¯è³¼è²·ã€Œå¤ªå®°åºœæ•£ç­–å¥—ç¥¨ã€ã€‚"],
                            "link": "https://www.dazaifutenmangu.or.jp/"
                        },
                        {
                            "time": "ä¸Šåˆ (10:30)",
                            "title": "ç«ˆé–€ç¥ç¤¾ (ç´…è‘‰ & é¬¼æ»…è–åœ°)",
                            "description": "è½‰ä¹˜ç¤¾å€å·´å£«å‰å¾€ä»¥çµç·£å’Œç´…è‘‰èåçš„ç«ˆé–€ç¥ç¤¾ã€‚é€™è£¡ä¹Ÿæ˜¯ã€Šé¬¼æ»…ä¹‹åˆƒã€‹ç²‰çµ²çš„æœè–åœ°ã€‚",
                            "transport": "å¾å¤ªå®°åºœç«™å‰æ­ä¹˜ç¤¾å€å·´å£«ã€Œã¾ã»ã‚ã°å· (Mahoroba)ã€è‡³ã€Œå†…å±± (ç«ˆé–€ç¥ç¤¾å‰)ã€ä¸‹è»Š (ç´„ 10 åˆ†é˜)ã€‚",
                            "mapLink": "https://maps.google.com/maps?q=Kamado+Shrine",
                            "notes": ["ç´…è‘‰å­£ç¯€çš„ç´…è‘‰éš§é“éå¸¸ç¾éº—ã€‚", "å·´å£«ç­æ¬¡ç´„ 30 åˆ†é˜ä¸€ç­ï¼Œè«‹æ³¨æ„æ™‚é–“ã€‚"],
                            "link": "https://kamadojinja.or.jp/"
                        },
                        {
                            "time": "ä¸­åˆ (12:30)",
                            "title": "å¤ªå®°åºœåƒé“ & æ¢…æé¤…",
                            "description": "å›åˆ°å¤ªå®°åºœç«™å‰ï¼Œé€›é€›ç†±é¬§çš„åƒé“ã€‚å¿…åƒå‰›å‡ºçˆçš„ã€Œæ¢…æé¤…ã€ï¼Œä¸¦åƒè§€è‘—åçš„éšˆç ”å¾è¨­è¨ˆæ˜Ÿå·´å…‹ã€‚",
                            "transport": "æ­ä¹˜å·´å£«è¿”å›å¤ªå®°åºœç«™ã€‚",
                            "mapLink": "https://maps.google.com/maps?q=Dazaifu+Omotesando",
                            "notes": ["æ¢…æé¤…å„å®¶å£å‘³ç•¥æœ‰ä¸åŒï¼Œå¯ä»¥å¤šè©¦å¹¾å®¶ã€‚", "æ˜Ÿå·´å…‹å¤ªå®°åºœè¡¨åƒé“åº—è¨­è¨ˆç¨ç‰¹ï¼Œå€¼å¾—æ‹ç…§ã€‚"],
                            "link": null
                        },
                        {
                            "time": "ä¸‹åˆ (15:30)",
                            "title": "å‰å¾€ç™¾é“ (Momochi) åœ°å€",
                            "description": "çµæŸå¤ªå®°åºœè¡Œç¨‹ï¼Œè¿”å›å¤©ç¥ä¸¦å‰å¾€ç™¾é“åœ°å€ï¼Œæ¥çºŒæ™šä¸Šçš„è³¼ç‰©èˆ‡ä¾¿ä¾¿å±•è¡Œç¨‹ã€‚",
                            "transport": "æ­è¥¿éµè¿”å›ã€Œå¤©ç¥ã€ï¼Œå†è½‰ä¹˜å·´å£« (å¦‚ W1, 302 ç­‰) è‡³ã€ŒPayPayå·¨è›‹å‰ã€æˆ–ã€Œä¹å·é†«ç™‚ä¸­å¿ƒã€ã€‚",
                            "mapLink": "https://maps.google.com/maps?q=Tenjin+Station",
                            "notes": [],
                            "link": null
                        },
                        {
                            "time": "å‚æ™š (17:00)", 
                            "title": "MARK IS ç¦å²¡ç™¾é“ (å¥½é€›!)", 
                            "description": "åœ¨ä¾¿ä¾¿å±•æ—é‚Šçš„è¶…å¤§å•†å ´ï¼é€™è£¡éå¸¸å¯¬æ•èˆ’é©ï¼Œæœ‰ ABC-Mart Grand Stage, Uniqlo, Nitori ä»¥åŠå¾ˆå¤šå¹´è¼•ä¼‘é–’å“ç‰Œï¼Œéå¸¸å¥½é€›ã€‚", 
                            "transport": "å°±åœ¨ E-ZO FUKUOKA éš”å£ï¼Œæ­¥è¡Œ 1 åˆ†é˜ã€‚",
                            "mapLink": "https://maps.google.com/maps?q=MARK+IS+Fukuoka+Momochi",
                            "notes": ["æ¨è–¦é€™è£¡çš„è¶…å¸‚ï¼Œç†Ÿé£Ÿé¸æ“‡å¾ˆå¤šã€‚", "Awesome Store æœ‰å¾ˆå¤šä¾¿å®œå¯æ„›çš„é›œè²¨ã€‚"], 
                            "link": "https://www.mec-markis.jp/fukuoka-momochi/"
                        },
                        { 
                            "time": "æ™šä¸Š (19:00)", 
                            "title": "ç¦å²¡ä¾¿ä¾¿å±• (Unko Museum)", 
                            "description": "å°±åœ¨éš”å£çš„ BOSS Eãƒ»ZO FUKUOKAï¼Œé«”é©—æœ‰è¶£åˆå¥½æ‹çš„ã€Œç¦å²¡ä¾¿ä¾¿å±•ã€ã€‚E-ZO è£¡é¢é‚„æœ‰ TeamLab Forest (å¦‚æœæœ‰æ™‚é–“çš„è©±)ã€‚", 
                            "transport": "æ­¥è¡Œ 1 åˆ†é˜ã€‚",
                            "mapLink": "https://maps.google.com/maps?q=BOSS+Eãƒ»ZO+FUKUOKA",
                            "notes": ["å±•è¦½é€šå¸¸ç‡Ÿæ¥­è‡³ 20:00 (æœ€å¾Œå…¥å ´ 19:30)ï¼Œè«‹æ³¨æ„æ™‚é–“ã€‚", "å¯ä»¥åœ¨ E-ZO æˆ– MARK IS äº«ç”¨æ™šé¤ã€‚"], 
                            "link": "https://e-zofukuoka.com/unko-museum/"
                        }
                    ]
                  }
                },
                { 
                  "day": 4, 
                  "date": "2025-11-20", 
                  "theme": "å¸‚å€è³æ¥“ & æœ€å¾Œæ¡è²·", 
                  "location": "ç¦å²¡", 
                  "activities": [ 
                    { 
                      "time": "ä¸Šåˆ (09:30)", 
                      "title": "èˆé¶´å…¬åœ’ & ç¦å²¡åŸè·¡ (è³æ¥“)", 
                      "description": "åœ¨å¸‚ä¸­å¿ƒçš„èˆé¶´å…¬åœ’æ‚ é–’æ•£æ­¥ï¼Œé€™è£¡æ˜¯å¦ä¸€å€‹è³æ¥“é»ã€‚ç™»ä¸Šç¦å²¡åŸè·¡çš„å¤©å®ˆå°ï¼Œçœºæœ›ç¦å²¡å¸‚æ™¯ã€‚", 
                      "transport": "æ­ä¹˜åœ°éµç©ºæ¸¯ç·šè‡³ã€Œå¤§æ¿ å…¬åœ’ç«™ã€æˆ–ã€Œèµ¤å‚ç«™ã€ï¼Œæ­¥è¡Œç´„ 5-10 åˆ†é˜ã€‚",
                      "mapLink": "https://maps.google.com/maps?q=Maizuru+Park+Fukuoka",
                      "notes": ["é£¯åº—éœ€å…ˆ Check-out ä¸¦å¯„æ”¾è¡Œæã€‚"], 
                      "link": "https://www.midorimachi.jp/mawpa/"
                    },
                    { 
                      "time": "ä¸­åˆ (12:00)", 
                      "title": "åˆé¤ & æœ€å¾Œæ¡è²· (å¤§å/å¤©ç¥)", 
                      "description": "å¯ä»¥é€›é€›ã€Œå¤§åã€(Daimyo) å€çš„å¤è‘—åº—ï¼Œæˆ–åœ¨å¤©ç¥åœ°ä¸‹è¡—è£œé½Šä¼´æ‰‹ç¦®ã€‚", 
                      "transport": "æ­ä¹˜åœ°éµæˆ–æ­¥è¡Œã€‚",
                      "mapLink": "https://maps.google.com/maps?q=Daimyo+Fukuoka",
                      "notes": ["è¡Œç¨‹è¼ƒç‚ºè¼•é¬†ï¼Œè«‹æ³¨æ„æ§åˆ¶æ™‚é–“æº–å‚™å‰å¾€æ©Ÿå ´ã€‚"], 
                      "link": null
                    },
                    { 
                      "time": "15:00", 
                      "title": "å‰å¾€ç¦å²¡æ©Ÿå ´ (FUK)", 
                      "description": "å¾é£¯åº—å–å›è¡Œæï¼Œæº–å‚™å‰å¾€æ©Ÿå ´ã€‚", 
                      "transport": "å¾ã€Œåšå¤šç«™ã€æˆ–ã€Œå¤©ç¥ç«™ã€æ­ä¹˜ã€Œåœ°éµç©ºæ¸¯ç·šã€è‡³ã€Œç¦å²¡æ©Ÿå ´ç«™ã€ï¼ˆåœ‹å…§ç·šï¼‰ï¼Œå†è½‰ä¹˜å…è²»æ¥é§å·´å£«è‡³åœ‹éš›ç·šèˆªå»ˆã€‚",
                      "mapLink": "https://maps.google.com/maps?q=Fukuoka+Airport+International+Terminal",
                      "notes": ["èˆªç­ 18:05 èµ·é£› (UO639)ï¼Œå»ºè­°æœ€æ™š 16:00 æŠµé”åœ‹éš›ç·šèˆªå»ˆã€‚"], 
                      "link": null
                    },
                    { 
                      "time": "18:05", 
                      "title": "å‡ºç™¼è¿”å› HKG", 
                      "description": "æ­ä¹˜ UO639 èˆªç­ï¼ŒçµæŸæ„‰å¿«çš„ç¦å²¡ä¹‹æ—…ã€‚", 
                      "transport": "N/A",
                      "mapLink": "https://maps.google.com/maps?q=Fukuoka+Airport",
                      "notes": [], 
                      "link": null
                    }
                  ] 
                }
            ],
            // è—åœ– 2.3.1: AI å¿…é ˆä¸»å‹•åŠ å…¥ 3-5 å€‹ç†±é–€ç¾é£Ÿæ¨è–¦
            "foodieList": [
                { 
                  "name": "åšå¤šã‚‚ã¤é‹ (Motsunabe)", 
                  "region": "ç¦å²¡", 
                  "tag": "å…§è‡Ÿé‹", 
                  "mapLink": "https://maps.google.com/maps?q=Motsunabe+Hakata" 
                },
                { 
                  "name": "å±‹å° (Yatai Stalls)", 
                  "region": "ç¦å²¡", 
                  "tag": "è·¯é‚Šæ”¤æ–‡åŒ–", 
                  "mapLink": "https://maps.google.com/maps?q=Yatai+Nakasu" 
                },
                { 
                  "name": "ä¸€è˜­æ‹‰éºµ (Ichiran Ramen)", 
                  "region": "ç¦å²¡", 
                  "tag": "è±šéª¨æ‹‰éºµ", 
                  "mapLink": "https://maps.google.com/maps?q=Ichiran+Ramen+Hakata" 
                },
                { 
                  "name": "ç„¼è‚‰ãƒãƒ£ãƒ³ãƒ”ã‚ªãƒ³ (Yakiniku Champion)", 
                  "region": "ç¦å²¡", 
                  "tag": "é«˜ç´šç‡’è‚‰", 
                  "mapLink": "https://maps.google.com/maps?q=Yakiniku+Champion+Hakata" 
                }
            ],
            // è—åœ– 2.2.5: AI å¿…é ˆè‡ªå‹•åˆ†æä¸¦åŠ å…¥ "category" éµ
            "coupons": [
                { "name": "Bic Camera", "discount": "æ»¿é¡å…ç¨…ï¼Œæœ€é«˜å†æŠ˜7%", "expiry": "2026/8/31", "link": "https://funtime.tw/c/blog-68172-1", "final_url": "https://www.funtime.com.tw/travelstore/coupon/BicCamera_250820.png", "category": "é›»å™¨" },
                { "name": "Salonia", "discount": "æŠ˜5%(éœ€èˆ‡Bic Cameraå„ªæƒ åˆ¸ä¸€èµ·ä½¿ç”¨)", "expiry": "2025/9/30", "link": "https://funtime.tw/c/blog-68172-19", "final_url": "https://www.funtime.com.tw/travelstore/coupon/salonia~250930.jpg?ftfrom=blog-68172-19", "category": "é›»å™¨" },
                { "name": "æ„›é›»ç‹Edion", "discount": "æ»¿é¡å…ç¨…ï¼Œæœ€é«˜å†æŠ˜7%", "expiry": "2026/12/31", "link": "https://funtime.tw/c/blog-68172-10", "final_url": "https://www.funtime.com.tw/travelstore/coupon/edion2025.jpg", "category": "é›»å™¨" },
                { "name": "Laox", "discount": "æ»¿é¡å…ç¨…ï¼Œå†æŠ˜8%", "expiry": "2025/12/31", "link": "https://funtime.tw/c/blog-68172-15", "final_url": "https://www.funtime.com.tw/travelstore/coupon/LAOX_2025.jpg", "category": "é›»å™¨" },
                { "name": "SUNDRUG", "discount": "æ»¿é¡å…ç¨…ï¼Œå†äº«3~7%æŠ˜æ‰£", "expiry": "ç„¡æœŸé™", "link": "https://funtime.tw/c/b2s50T", "final_url": "https://www.funtime.com.tw/travelstore/coupon/sundrug%20_funtime.jpg", "category": "è—¥å¦" },
                { "name": "é¶´ç¾½è—¥å¦", "discount": "æ»¿é¡å…ç¨…ï¼Œæœ€é«˜äº«å…ç¨…+7%å„ªæƒ ", "expiry": "2025/12/31", "link": "https://funtime.tw/c/blog-68172-11", "final_url": "https://www.funtime.com.tw/travelstore/coupon/tsuruha2025.jpg", "category": "è—¥å¦" },
                { "name": "æœ­å¹Œè—¥å¦", "discount": "æ»¿é¡å…ç¨…ï¼Œæœ€é«˜äº«å…ç¨…+5%å„ªæƒ ", "expiry": "ç„¡æœŸé™", "link": "https://funtime.tw/c/blog-68172-13", "final_url": "https://www.funtime.com.tw/travelstore/coupon/sapporo.jpg", "category": "è—¥å¦" },
                { "name": "Cosmos", "discount": "æ»¿é¡å…ç¨…ï¼Œæœ€é«˜äº«å…ç¨…+9%å„ªæƒ ", "expiry": "2025/12/31", "link": "https://funtime.tw/c/DsrcXF", "final_url": "https://www.funtime.com.tw/travelstore/coupon/cosmos2025.jpg", "category": "è—¥å¦" },
                { "name": "è¿‘éµç™¾è²¨åº—", "discount": "æ»¿2åƒæ—¥åœ“(ä¸å«ç¨…)ï¼Œå¯äº«æœ‰95æŠ˜å„ªæƒ ", "expiry": "2025/12/31", "link": "https://funtime.tw/c/blog-68172-14", "final_url": "https://www.funtime.com.tw/travelstore/coupon/kintetsu2025.png", "region": "é—œè¥¿", "category": "ç™¾è²¨" },
                { "name": "å¤§ä¸¸æ¾å‚å±‹", "discount": "å–®ç­†æ¶ˆè²»å«ç¨…æ»¿3åƒæ—¥åœ“ï¼Œäº«95æŠ˜", "expiry": "2026/8/31", "link": "https://funtime.tw/c/blog-68172-6", "final_url": "https://www.funtime.com.tw/travelstore/coupon/daimaru_250820.pdf", "category": "ç™¾è²¨" },
                { "name": "è¥¿æ­¦ç™¾è²¨", "discount": "æ¶ˆè²»æ»¿1åƒæ—¥åœ“ï¼Œäº«95æŠ˜", "expiry": "2025/12/31", "link": "https://funtime.tw/c/blog-68172-2", "final_url": "https://www.funtime.com.tw/travelstore/coupon/seibu2025.png", "category": "ç™¾è²¨" },
                { "name": "åå¤å±‹åéµç™¾è²¨åº—", "discount": "å–®ä»¶æ¶ˆè²»æ»¿1åƒæ—¥åœ“(ä¸å«ç¨…)<br>å…ç¨…å†æŠ˜5%", "expiry": "2026/2/28", "link": "https://funtime.tw/c/blog-68172-18", "final_url": "https://www.funtime.com.tw/travelstore/coupon/meitetsu_250516.png", "region": "åå¤å±‹", "category": "ç™¾è²¨" },
                { "name": "äº¬ç‹ç™¾è²¨", "discount": "å–®ç­†æ¶ˆè²»æ»¿3åƒæ—¥åœ“ï¼Œäº«95æŠ˜", "expiry": "2026/03/31", "link": "https://funtime.tw/c/blog-68172-3", "final_url": "https://www.funtime.com.tw/travelstore/coupon/Keio_2.jpeg", "region": "æ±äº¬", "category": "ç™¾è²¨" },
                { "name": "å°ç”°æ€¥ç™¾è²¨", "discount": "æ¶ˆè²»æ»¿1åƒæ—¥åœ“(å«ç¨…)ï¼Œå¯äº«6%å„ªæƒ ", "expiry": "2028/3/31", "link": "https://funtime.tw/c/blog-68172-12", "final_url": "https://www.funtime.com.tw/travelstore/coupon/odakyu.png", "region": "æ±äº¬", "category": "ç™¾è²¨" },
                { "name": "Donkiå”å‰è¨¶å¾·", "discount": "æ»¿é¡å…ç¨…ï¼Œå†æŠ˜5%", "expiry": "ç„¡æœŸé™", "link": "https://funtime.tw/c/blog-68172-9", "final_url": "https://japanportal.donki-global.com/coupon/?ptcd=0076003303", "category": "ç¶œåˆ/å…ç¨…" },
                { "name": "éŠ€åº§æ¨‚å¤©å…ç¨…åº—", "discount": "æ»¿1è¬æ—¥åœ“ï¼ŒæŠ˜1åƒæ—¥åœ“<br>æ»¿2è¬æ—¥åœ“ï¼ŒæŠ˜2åƒæ—¥åœ“", "expiry": "2026/1/31", "link": "https://funtime.tw/c/blog-68172-7", "final_url": "https://www.funtime.com.tw/travelstore/coupon/Lottedutyfree_GINZA_FunTime2025.jpg", "region": "æ±äº¬", "category": "ç¶œåˆ/å…ç¨…" },
                { "name": "æˆç”°æ©Ÿå ´å…ç¨…åº—", "discount": "äº«æœ‰95æŠ˜å„ªæƒ ", "expiry": "2026/3/31", "link": "https://funtime.tw/c/blog-68172-16", "final_url": "https://duty-free-japan.jp/narita/ta/content/coupon2833-30.html", "region": "æ±äº¬", "category": "ç¶œåˆ/å…ç¨…" },
                { "name": "æˆç”°/ç¾½ç”°æ©Ÿå ´å…ç¨…åº—ç·šä¸Šè¨‚", "discount": "äº«æœ‰95æŠ˜å„ªæƒ ", "expiry": "ç„¡æœŸé™", "link": "https://funtime.tw/c/blog-68172-17", "final_url": "https://duty-free-japan.jp/qrposter/tc/?agentid=123", "region": "æ±äº¬", "category": "ç¶œåˆ/å…ç¨…" },
                { "name": "Victoriaé‹å‹•ç”¨å“", "discount": "å…ç¨…å†æŠ˜5%", "expiry": "2026/6/30", "link": "https://funtime.tw/c/blog-68172-8", "final_url": "https://www.funtime.com.tw/travelstore/coupon/FunTime_Victoria_202606.jpg", "category": "å…¶ä»–" }
            ]
        };

        // å…¨å±€ç‹€æ…‹
        const appState = {
            weatherByLocation: {}, // å„²å­˜å¤©æ°£æ•¸æ“š
            currentView: 'itinerary-view', // ç•¶å‰è¦–åœ–
            // æ–°å¢ç‹€æ…‹ï¼šDay 3 é¸æ“‡çš„ Plan (é»˜èªç‚º 'A')
            day3Plan: 'A'
        };

        // DOM å…ƒç´ 
        const $ = (selector) => document.querySelector(selector);
        const $$ = (selector) => document.querySelectorAll(selector);

        // ==========================================================
        // åŠŸèƒ½ 1: æ ¸å¿ƒè¼”åŠ©å‡½æ•¸ (åš´æ ¼éµå¾ªè—åœ– 2.3.4)
        // ==========================================================

        /**
         * è—åœ– 2.3.4: å…§å»º SVG åœ–ç¤ºç³»çµ±
         * @param {string} name - åœ–ç¤ºåç¨±
         * @param {object} options - { classes: '...' }
         * @returns {string} SVG 
         */
        function getIconSvg(name, options = {}) {
            const classes = options.classes || 'w-full h-full';
            const icons = {
                // Nav
                'calendar-days': '<path stroke-linecap="round" stroke-linejoin="round" d="M6.75 3v2.25m10.5-2.25v2.25M6.75 21h10.5a2.25 2.25 0 0 0 2.25-2.25V6.75a2.25 2.25 0 0 0-2.25-2.25H6.75A2.25 2.25 0 0 0 4.5 6.75v12A2.25 2.25 0 0 0 6.75 21Z" />',
                'utensils': '<path stroke-linecap="round" stroke-linejoin="round" d="M3.75 5.25h16.5m-16.5 4.5h16.5m-16.5 4.5h16.5m-16.5 4.5h16.5" />', // ç°¡æ˜“æ›¿ä»£
                'ticket': '<path stroke-linecap="round" stroke-linejoin="round" d="M16.5 6v.75a2.25 2.25 0 0 1-2.25 2.25H9.75a2.25 2.25 0 0 1-2.25-2.25V6m3 0v.75a2.25 2.25 0 0 0 2.25 2.25h1.5a2.25 2.25 0 0 0 2.25-2.25V6m-4.5 0h4.5m-4.5 0h-6A2.25 2.25 0 0 0 6 8.25v10.5A2.25 2.25 0 0 0 8.25 21h7.5A2.25 2.25 0 0 0 18 18.75V8.25A2.25 2.25 0 0 0 15.75 6m-7.5 0h7.5" />',
                // UI
                'arrow-left': '<path stroke-linecap="round" stroke-linejoin="round" d="M10.5 19.5 3 12m0 0 7.5-7.5M3 12h18" />',
                'bell': '<path stroke-linecap="round" stroke-linejoin="round" d="M14.857 17.082a23.848 23.848 0 0 0 5.454-1.31A8.967 8.967 0 0 1 18 9.75V9A6 6 0 0 0 6 9v.75a8.967 8.967 0 0 1-2.312 6.022c1.733.64 3.56 1.085 5.455 1.31m5.714 0a3 3 0 0 1-5.714 0M1.125 11.168a8.96 8.96 0 0 0 1.621 3.122c1.733.64 3.56 1.085 5.455 1.31m5.714 0a3 3 0 0 1-5.714 0m5.714 0a8.959 8.959 0 0 0 1.621-3.122m-1.621 3.122a23.847 23.847 0 0 1 5.454-1.31M13.5 17.082a23.847 23.847 0 0 0 5.454-1.31" />',
                'map-pin': '<path stroke-linecap="round" stroke-linejoin="round" d="M15 10.5a3 3 0 1 1-6 0 3 3 0 0 1 6 0Z" /><path stroke-linecap="round" stroke-linejoin="round" d="M19.5 10.5c0 7.142-7.5 11.25-7.5 11.25S4.5 17.642 4.5 10.5a7.5 7.5 0 1 1 15 0Z" />',
                'tram-front': '<path stroke-linecap="round" stroke-linejoin="round" d="M15.59 14.37a6 6 0 0 1-5.18 0m0 0a6 6 0 0 0-5.18 0M15.59 14.37v5.25A2.25 2.25 0 0 1 13.34 22H10.66a2.25 2.25 0 0 1-2.25-2.25v-5.25m3.58 0V12m0 0v-5.25A2.25 2.25 0 0 1 10.66 4.5h2.68A2.25 2.25 0 0 1 15.59 6.75v5.25Z" />',
                'link-2': '<path stroke-linecap="round" stroke-linejoin="round" d="M13.19 8.688a4.5 4.5 0 0 1 1.242 7.244l-4.5 4.5a4.5 4.5 0 0 1-6.364-6.364l1.757-1.757m13.35-.622 1.757-1.757a4.5 4.5 0 0 0-6.364-6.364l-4.5 4.5a4.5 4.5 0 0 0 1.242 7.244" />',
                'image': '<path stroke-linecap="round" stroke-linejoin="round" d="M2.25 15.75l5.159-5.159a2.25 2.25 0 0 1 3.182 0l5.159 5.159m-1.5-1.5 1.409-1.409a2.25 2.25 0 0 1 3.182 0l2.909 2.909m-18 3.75h16.5a1.5 1.5 0 0 0 1.5-1.5V6a1.5 1.5 0 0 0-1.5-1.5H3.75A1.5 1.5 0 0 0 2.25 6v12a1.5 1.5 0 0 0 1.5 1.5Zm1.5-6a.75.75 0 1 1-1.5 0 .75.75 0 0 1 1.5 0Z" />',
                'alert-triangle': '<path stroke-linecap="round" stroke-linejoin="round" d="M12 9v3.75m-9.303 3.376c-.866 1.5.217 3.374 1.948 3.374h14.71c1.73 0 2.813-1.874 1.948-3.374L13.949 3.378c-.866-1.5-3.032-1.5-3.898 0L2.697 16.126ZM12 15.75h.007v.008H12v-.008Z" />',
                'refresh-ccw': '<path stroke-linecap="round" stroke-linejoin="round" d="M16.023 9.348h4.992v-.001M2.985 19.644v-4.992m0 0h4.992m-4.993 0 3.181 3.183a8.25 8.25 0 0 0 13.803-3.7M4.031 9.865a8.25 8.25 0 0 1 13.803-3.7l3.181 3.182m0-4.991v4.99" />',
                // AI / Gemini
                'sparkles': '<path stroke-linecap="round" stroke-linejoin="round" d="M9.813 15.904L9 18l-1.813-2.096a.75.75 0 0 1-.437-.695V13.5a.75.75 0 0 1 .75-.75h1.5a.75.75 0 0 1 .75.75v1.709a.75.75 0 0 1-.437.695Zm5.437 0L15 18l-1.813-2.096a.75.75 0 0 1-.437-.695V13.5a.75.75 0 0 1 .75-.75h1.5a.75.75 0 0 1 .75.75v1.709a.75.75 0 0 1-.437.695Zm-5.437-5.437L9 12.5l-1.813-2.096a.75.75 0 0 1-.437-.695V8.25a.75.75 0 0 1 .75-.75h1.5a.75.75 0 0 1 .75.75v1.709a.75.75 0 0 1-.437.695Zm5.437 0L15 12.5l-1.813-2.096a.75.75 0 0 1-.437-.695V8.25a.75.75 0 0 1 .75-.75h1.5a.75.75 0 0 1 .75.75v1.709a.75.75 0 0 1-.437.695Z" />',
                // Coupon Categories (from config)
                'plug-zap': '<path stroke-linecap="round" stroke-linejoin="round" d="M16.28 11.47a.75.75 0 0 1 0 1.06l-7.5 7.5a.75.75 0 0 1-1.06-1.06L15.22 11.47a.75.75 0 0 1 1.06 0Z" /><path stroke-linecap="round" stroke-linejoin="round" d="MM8.25 4.5l7.5 7.5-7.5 7.5" />', // ç°¡æ˜“æ›¿ä»£
                'pilcrow': '<path stroke-linecap="round" stroke-linejoin="round" d="M15.75 3.75V16.5m-1.5-12.75H8.25m0 0v12.75m0-12.75a3 3 0 1 1 0 6H12m0 0a3 3 0 1 0 0 6H8.25m0 0v-6" />',
                'shopping-bag': '<path stroke-linecap="round" stroke-linejoin="round" d="M15.75 10.5V6a3.75 3.75 0 1 0-7.5 0v4.5m11.356-1.356a1.75 1.75 0 0 1 0 2.712l-8.25 8.25a1.75 1.75 0 0 1-2.712 0l-8.25-8.25a1.75 1.75 0 0 1 0-2.712l6.375-6.375a1.75 1.75 0 0 1 2.712 0L9 10.5h.75m.75 0H15m0 0h2.25m1.5 0H15m0 0l-1.5-1.5M15 10.5l1.5 1.5" />',
                'gem': '<path stroke-linecap="round" stroke-linejoin="round" d="M11.25 11.25l.041-.02a.75.75 0 0 1 1.063.852l-.705 1.932a.75.75 0 0 0 1.063.852l.041-.021M11.25 11.25l-.041.02a.75.75 0 0 0-1.063-.852l.705-1.932a.75.75 0 0 1-1.063-.852l-.041.021m0 0L12 3.75l3.454 4.546-1.217 3.35m-5.474 0L3 3.75l3.454 4.546 1.217 3.35" />',
                'shopping-cart': '<path stroke-linecap="round" stroke-linejoin="round" d="M2.25 3h1.386c.51 0 .955.343 1.087.835l.383 1.437M7.5 14.25a3 3 0 0 0-3 3h15.75m-12.75-3h11.218c.51 0 .962-.343 1.087-.835l3.879-14.863a.75.75 0 0 0-.73-.93H3.75M7.5 14.25c.621 0 1.15-.403 1.342-.958l.53-1.542m-1.872.495a3 3 0 1 1 0-6 3 3 0 0 1 0 6Zm12.75 0a3 3 0 1 1 0-6 3 3 0 0 1 0 6Z" />',
            };
            const svgContent = icons[name] || '';
            return `<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="${classes}">${svgContent}</svg>`;
        }

        /**
         * è—åœ– 2.3.4: æ ¼å¼åŒ–æ—¥æœŸ
         * @param {string} dateString (YYYY-MM-DD)
         * @returns {string} (MMæœˆDDæ—¥, æ˜ŸæœŸX)
         */
        function formatDate(dateString) {
            const date = new Date(dateString + 'T00:00:00'); // é¿å…æ™‚å€å•é¡Œ
            const month = (date.getMonth() + 1).toString().padStart(2, '0');
            const day = date.getDate().toString().padStart(2, '0');
            const week = ['æ—¥', 'ä¸€', 'äºŒ', 'ä¸‰', 'å››', 'äº”', 'å…­'][date.getDay()];
            return `(${month}æœˆ${day}æ—¥, æ˜ŸæœŸ${week})`;
        }

        /**
         * è—åœ– 2.3.4: WMO å¤©æ°£ä»£ç¢¼è½‰ Emoji
         * @param {number} code - WMO Code
         * @returns {string} Emoji
         */
        function getWeatherIcon(code) {
            if ([0, 1].includes(code)) return 'â˜€ï¸'; // Clear, Mainly clear
            if ([2].includes(code)) return 'ğŸŒ¤ï¸'; // Partly cloudy
            if ([3].includes(code)) return 'â˜ï¸'; // Overcast
            if ([45, 48].includes(code)) return 'ğŸŒ«ï¸'; // Fog
            if ([51, 53, 55, 61, 63, 65, 80, 81, 82].includes(code)) return 'ğŸŒ§ï¸'; // Drizzle, Rain
            if ([56, 57, 66, 67].includes(code)) return 'ğŸŒ¨ï¸'; // Freezing Drizzle/Rain
            if ([71, 73, 75, 77, 85, 86].includes(code)) return 'â„ï¸'; // Snow
            if ([95, 96, 99].includes(code)) return 'â›ˆï¸'; // Thunderstorm
            return 'â“';
        }

        /**
         * è—åœ– 2.3.4: å¡«å……æ¨¡æ¿
         * @param {string} templateId - æ¨¡æ¿ ID
         * @param {object} data - æ•¸æ“š
         * @returns {HTMLElement} 
         */
        function populateTemplate(templateId, data) {
            const template = $(templateId);
            if (!template) {
                console.error(`Template not found: ${templateId}`);
                return null;
            }
            const clone = document.importNode(template.content, true);
            
            // å¡«å…… [data-text]
            clone.querySelectorAll('[data-text]').forEach(el => {
                const key = el.dataset.text;
                if (data.hasOwnProperty(key)) {
                    el.innerHTML = data[key]; // ä½¿ç”¨ innerHTML ä»¥æ”¯æ´ <br>
                }
            });
            return clone;
        }

        // ==========================================================
        // åŠŸèƒ½ 2: é é¢æ¸²æŸ“èˆ‡å°è¦½ (åš´æ ¼éµå¾ªè—åœ– 2.3.4)
        // ==========================================================

        /**
         * è—åœ– 2.3.4: æ¸²æŸ“ä¸»è¡Œç¨‹å¡ç‰‡
         */
        function renderItinerary() {
            const container = $('#itinerary-view');
            container.innerHTML = ''; // æ¸…ç©º
            
            tripData.itinerary.forEach((day, index) => {
                const cardData = {
                    day: `Day ${day.day}`,
                    date: formatDate(day.date),
                    theme: day.theme
                };
                
                const card = populateTemplate('#template-itinerary-card', cardData);
                const cardElement = card.firstElementChild;
                
                // è—åœ– 2.3.4: æª¢æŸ¥æ˜¯å¦æœ‰ notesï¼Œä¸¦é¡¯ç¤ºéˆ´éºåœ–ç¤º
                const hasNotes = day.activities.some(act => act.notes && act.notes.length > 0);
                if (hasNotes) {
                    const iconContainer = cardElement.querySelector('.note-icon-container');
                    iconContainer.innerHTML = getIconSvg('bell', { classes: 'w-4 h-4 text-yellow-400' });
                }
                
                // ç¶å®šé»æ“Šäº‹ä»¶
                cardElement.addEventListener('click', () => {
                    renderDetailPage(day);
                    showPage('#detail-page');
                });
                
                container.appendChild(cardElement);
            });
        }

        /**
         * è—åœ– 2.3.4: æ¸²æŸ“è©³æƒ…é 
         * @param {object} dayData - ç•¶å¤©çš„è¡Œç¨‹æ•¸æ“š
         */
        function renderDetailPage(dayData) {
            const header = $('#detail-header');
            const content = $('#detail-content');
            
            // æ±ºå®šè¦é¡¯ç¤ºçš„æ´»å‹•æ¸…å–® (Plan A æˆ– Plan B)
            // åªæœ‰ Day 3 (index 2) æ”¯æ´ Plan B
            let currentActivities = dayData.activities;
            let currentTheme = dayData.theme;
            let currentLocation = dayData.location;

            // æª¢æŸ¥æ˜¯å¦ç‚º Day 3 ä¸” appState.day3Plan ç‚º 'B'
            const isDay3 = dayData.day === 3;
            if (isDay3 && appState.day3Plan === 'B' && dayData.planB) {
                currentActivities = dayData.planB.activities;
                currentTheme = dayData.planB.theme;
                currentLocation = dayData.planB.location;
            }
            
            // è—åœ– 2.3.4 (é—œéµ): å‹•æ…‹ç”Ÿæˆè©³æƒ…é é ‚æ¬„
            header.innerHTML = `
                <button id="back-button" class="p-2 -ml-2 text-gray-300 hover:text-white">
                    ${getIconSvg('arrow-left', { classes: 'w-6 h-6' })}
                </button>
                <h2 class="text-xl font-bold flex-grow truncate px-2" data-text="theme">${currentTheme}</h2>
                <div class="weather-container w-12 h-10 flex items-center justify-center flex-shrink-0 text-center">
                    <div class="loader-small"></div>
                </div>
            `;
            
            // ç¶å®šè¿”å›æŒ‰éˆ•
            $('#back-button').addEventListener('click', () => {
                showPage('#main-page-wrapper');
            });
            
            // æ›´æ–°å¤©æ°£ (æ ¹æ“šç•¶å‰ Plan çš„åœ°é»)
            updateWeatherUI(currentLocation, dayData.date, header.querySelector('.weather-container'));

            // æ¸²æŸ“æ™‚é–“è»¸
            content.innerHTML = '';

            // Plan B åˆ‡æ›æŒ‰éˆ• (å¦‚æœè©²å¤©æœ‰ Plan B)
            if (dayData.planB) {
                const planSwitchContainer = document.createElement('div');
                planSwitchContainer.className = "mb-6 flex justify-center";
                const buttonText = appState.day3Plan === 'A' ? "ğŸ”„ åˆ‡æ›è‡³ Plan B: å¤ªå®°åºœ & ç«ˆé–€ç¥ç¤¾" : "ğŸ”„ åˆ‡æ›å› Plan A: å‘‘å±±è¦³éŸ³å¯º";
                const buttonClass = appState.day3Plan === 'A' ? "bg-indigo-600 hover:bg-indigo-500 text-white" : "bg-gray-600 hover:bg-gray-500 text-gray-200";
                
                planSwitchContainer.innerHTML = `
                    <button id="plan-switch-btn" class="${buttonClass} px-4 py-2 rounded-full text-sm font-semibold shadow-lg transition-colors flex items-center gap-2">
                        ${getIconSvg('refresh-ccw', { classes: 'w-4 h-4' })}
                        ${buttonText}
                    </button>
                `;
                content.appendChild(planSwitchContainer);

                // ç¶å®šåˆ‡æ›äº‹ä»¶
                content.querySelector('#plan-switch-btn').addEventListener('click', () => {
                    appState.day3Plan = appState.day3Plan === 'A' ? 'B' : 'A';
                    renderDetailPage(dayData); // é‡æ–°æ¸²æŸ“ç•¶å‰é é¢
                });
            }

            currentActivities.forEach(activity => {
                const item = populateTemplate('#template-timeline-item', activity);
                if (!item) return;

                // è—åœ– 2.3.4 (æƒ…å¢ƒå¼æé†’): è™•ç† Notes
                const notesContainer = item.querySelector('.notes-container');
                if (activity.notes && activity.notes.length > 0) {
                    notesContainer.classList.remove('hidden');
                    const notesContent = notesContainer.querySelector('.notes-content');
                    notesContent.innerHTML = activity.notes.map(note => `<p>â€¢ ${note}</p>`).join('');
                    // æ’å…¥è­¦ç¤ºåœ–ç¤º
                    notesContainer.querySelector('.w-5.h-5').innerHTML = getIconSvg('alert-triangle', { classes: 'w-full h-full' });
                }
                
                // è™•ç†äº¤é€šå’Œåœ°åœ–é€£çµ
                const transportLink = item.querySelector('a.transport-link');
                if (transportLink) {
                    transportLink.href = activity.mapLink;
                    // æ’å…¥åœ–ç¤º
                    transportLink.querySelector('.w-5.h-5:first-child').innerHTML = getIconSvg('tram-front', { classes: 'w-full h-full' });
                    transportLink.querySelector('.w-5.h-5:last-child').innerHTML = getIconSvg('map-pin', { classes: 'w-full h-full' });
                }
                
                // è—åœ– 2.3.4 (é—œéµ): è™•ç†ç¨ç«‹çš„ç›¸é—œé€£çµæŒ‰éˆ•
                const externalLinkContainer = item.querySelector('.external-link-container');
                if (activity.link && externalLinkContainer) {
                    externalLinkContainer.innerHTML = `
                        <a href="${activity.link}" target="_blank" rel="noopener noreferrer" class="external-link inline-flex items-center justify-center w-10 h-10 bg-green-900/30 hover:bg-green-800/50 text-green-300 p-2 rounded-md transition-colors">
                            ${getIconSvg('link-2', { classes: 'w-5 h-5' })}
                        </a>
                    `;
                }

                content.appendChild(item);
            });
        }

        /**
         * è—åœ– 2.3.4: æ¸²æŸ“ç¾é£Ÿæ¸…å–®
         */
        function renderFoodieList() {
            const container = $('#saved-foodie-list');
            container.innerHTML = ''; // æ¸…ç©º
            
            const regions = config.categories.foodie.regionOrder;
            const allFoodies = tripData.foodieList;

            // æ ¹æ“š config é †åºæ¸²æŸ“
            regions.forEach(region => {
                const regionItems = allFoodies.filter(item => item.region === region);
                if (regionItems.length > 0) {
                    const header = document.createElement('h3');
                    header.className = "text-base font-semibold text-gray-400 uppercase tracking-wide";
                    header.textContent = region;
                    container.appendChild(header);
                    
                    const regionGrid = document.createElement('div');
                    regionGrid.className = "space-y-4"; // è—åœ– 2.3.3 è¦æ±‚ #foodie-view space-y-6ï¼Œé€™è£¡å…§å±¤ç”¨ space-y-4
                    
                    regionItems.forEach(item => {
                        const card = createFoodieCard(item);
                        regionGrid.appendChild(card);
                    });
                    container.appendChild(regionGrid);
                }
            });
        }

        /**
         * è—åœ– 2.3.4 (é—œéµ): å¯¦ä½œ createFoodieCard å‡½æ•¸
         * @param {object} item - ç¾é£Ÿæ•¸æ“š
         * @param {boolean} isAi - æ˜¯å¦ç‚º AI ç”Ÿæˆ
         * @returns {HTMLElement} 
         */
        function createFoodieCard(item, isAi = false) {
            const card = populateTemplate('#template-foodie-card', item);
            const cardElement = card.firstElementChild;
            
            // è—åœ– 2.3.4 (é—œéµ): è¨­ç½® mapLink
            const mapLink = cardElement.querySelector('a.map-link');
            mapLink.href = item.mapLink || `https://maps.google.com/maps?q=${encodeURIComponent(item.googleMapsQuery || item.name)}`;
            
            // è—åœ– 2.3.4 (é—œéµ): è¨­ç½® map-pin åœ–ç¤º
            mapLink.innerHTML = getIconSvg('map-pin', { classes: 'w-6 h-6 text-gray-300' });
            
            // è™•ç† AI æ¨™ç±¤
            if (isAi) {
                const aiBadgeContainer = cardElement.querySelector('.ai-badge');
                aiBadgeContainer.innerHTML = `
                    <span class="inline-flex items-center gap-1 text-sm text-indigo-300 bg-indigo-900/50 px-2 py-0.5 rounded-full">
                        ${getIconSvg('sparkles', { classes: 'w-4 h-4' })}
                        AI
                    </span>
                `;
            }
            
            return cardElement;
        }


        /**
         * è—åœ– 2.3.4: æ¸²æŸ“å„ªæƒ åˆ¸
         */
        function renderCoupons() {
            const container = $('#coupon-list-container');
            container.innerHTML = '';
            
            const categories = config.categories.coupons.order;
            const icons = config.categories.coupons.icons;
            
            categories.forEach(category => {
                const items = tripData.coupons.filter(c => c.category === category);
                if (items.length === 0) return;
                
                // è—åœ– 2.3.4 (é—œéµ): æ¸²æŸ“åˆ†é¡æ¨™é¡Œ (å«åœ–ç¤º)
                const categoryContainer = document.createElement('div');
                categoryContainer.className = "category-section mb-6";
                categoryContainer.innerHTML = `
                    <h3 class="flex items-center gap-2 text-lg font-semibold text-gray-200 mb-3">
                        <span class="w-5 h-5 text-blue-400">${getIconSvg(icons[category] || 'ticket', { classes: 'w-full h-full' })}</span>
                        ${category}
                    </h3>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <!-- å¡ç‰‡å°‡æ’å…¥æ­¤è™• -->
                    </div>
                `;
                
                const grid = categoryContainer.querySelector('.grid');
                
                items.forEach(item => {
                    const card = populateTemplate('#template-coupon-card', item);
                    const cardElement = card.firstElementChild;

                    // è—åœ– 2.3.4 (é—œéµ): æ¸²æŸ“å¡ç‰‡åœ–ç¤º (image vs link-2)
                    const iconContainer = cardElement.querySelector('.link-icon-container');
                    const isImage = item.final_url.match(/\.(jpeg|jpg|gif|png|pdf)$/i);
                    const iconName = isImage ? 'image' : 'link-2';
                    iconContainer.innerHTML = getIconSvg(iconName, { classes: 'w-full h-full' });
                    
                    // ç¶å®šé»æ“Šäº‹ä»¶
                    // FIX: éŒ¯èª¤åŸå› æ˜¯ cardElement.parentElement åœ¨ appendChild ä¹‹å‰æ˜¯ nullã€‚
                    // æ‡‰ç›´æ¥ç¶å®šåˆ° cardElement (å³ div.card) æœ¬èº«ã€‚
                    cardElement.addEventListener('click', (e) => {
                        e.preventDefault();
                        handleCouponClick(item);
                    });
                    
                    grid.appendChild(cardElement); // æ­¤è™•ä½¿ç”¨ cardElement
                });
                
                container.appendChild(categoryContainer);
            });
        }

        /**
         * è—åœ– 2.3.4: è™•ç†å„ªæƒ åˆ¸é»æ“Šé‚è¼¯
         */
        function handleCouponClick(item) {
            const url = item.final_url;
            const isImage = url.match(/\.(jpeg|jpg|gif|png)$/i);
            const isPdf = url.endsWith('.pdf');

            if (isImage) {
                $('#modal-title').textContent = item.name;
                $('#modal-image').src = url;
                $('#modal-image').style.display = 'block';
                $('#coupon-modal').classList.remove('hidden');
            } else if (isPdf) {
                // PDF ä¹Ÿè¦–ç‚ºåœ–ç‰‡é€£çµå½ˆçª—ï¼Œä½†åœ¨ img src ä¸­å¯èƒ½ç„¡æ³•é¡¯ç¤º
                // ç‚ºç°¡åŒ–ï¼Œæˆ‘å€‘ä¹Ÿç”¨æ–°åˆ†é é–‹å•Ÿ
                window.open(url, '_blank', 'noopener,noreferrer');
            } else {
                // ç¶²é é€£çµ
                window.open(url, '_blank', 'noopener,noreferrer');
            }
        }

        /**
         * è—åœ– 2.3.4: åˆ‡æ›é é¢è¦–åœ–
         */
        function switchView(viewId) {
            // éš±è—æ‰€æœ‰
            ['#itinerary-view', '#foodie-view', '#coupon-view'].forEach(id => {
                $(id).classList.add('hidden');
            });
            
            // é¡¯ç¤ºç›®æ¨™
            // FIX: viewId å‚³å…¥çš„æ˜¯ 'itinerary-view'ï¼Œç¼ºå°‘ '#'ã€‚
            // å¿…é ˆä½¿ç”¨ $() è¼”åŠ©å‡½æ•¸ä¾†é¸å– IDã€‚
            const viewElement = $(`#${viewId}`);
            if (viewElement) {
                viewElement.classList.remove('hidden');
            } else {
                console.error(`View element not found: #${viewId}`);
            }
            
            // æ›´æ–°æŒ‰éˆ•ç‹€æ…‹
            $$('.nav-button').forEach(btn => {
                if (btn.dataset.view === viewId) {
                    btn.classList.add('text-blue-400');
                    btn.classList.remove('text-gray-400');
                } else {
                    btn.classList.add('text-gray-400');
                    btn.classList.remove('text-blue-400');
                }
            });
            
            appState.currentView = viewId;
        }

        /**
         * è—åœ– 2.3.4: é é¢æ»‘å‹•
         */
        function showPage(pageId) {
            if (pageId === '#detail-page') {
                $('#detail-page').classList.remove('page-hidden');
                $('#detail-page').classList.add('page-visible');
                $('#main-page-wrapper').classList.add('page-hidden');
            } else {
                // è¿”å›ä¸»é 
                $('#detail-page').classList.add('page-hidden');
                $('#detail-page').classList.remove('page-visible');
                $('#main-page-wrapper').classList.remove('page-hidden');
            }
        }

        // ==========================================================
        // åŠŸèƒ½ 3: æ™ºèƒ½å¤©æ°£é å ± (åš´æ ¼éµå¾ªè—åœ– 2.3.4)
        // ==========================================================

        /**
         * è—åœ– 2.3.4 (åŠŸèƒ½ 3): ç²å–æ‰€æœ‰å¤©æ°£æ•¸æ“š (æ··åˆé‚è¼¯)
         */
        async function fetchAllWeatherData() {
            const locations = tripData.locations;
            const startDate = tripData.itinerary[0].date;
            const endDate = tripData.itinerary[tripData.itinerary.length - 1].date;
            const simToday = config.simulationDate; // è®€å–æ¨¡æ“¬çš„ä»Šå¤©

            // è—åœ– 2.3.4 (BUG ä¿®æ­£): å‹•æ…‹è¨ˆç®—å»å¹´åŒæœŸ
            const start = new Date(startDate);
            const end = new Date(endDate);
            const lastYear = start.getFullYear() - 1;
            
            // ç¢ºä¿æ—¥æœŸæ ¼å¼æ­£ç¢º (YYYY-MM-DD)
            const histStartDate = `${lastYear}-${(start.getMonth() + 1).toString().padStart(2, '0')}-${start.getDate().toString().padStart(2, '0')}`;
            const histEndDate = `${lastYear}-${(end.getMonth() + 1).toString().padStart(2, '0')}-${end.getDate().toString().padStart(2, '0')}`;
            
            const commonParams = 'daily=weather_code,temperature_2m_max,temperature_2m_min&timezone=Asia%2FTokyo';

            for (const name in locations) {
                const loc = locations[name];
                
                // è—åœ– 2.3.4 (æ ¸å¿ƒå‡ç´š): åŒæ™‚ç™¼é€å…©å€‹è«‹æ±‚
                const forecastUrl = `${config.api.weather.forecast}?latitude=${loc.lat}&longitude=${loc.lon}&${commonParams}&start_date=${startDate}&end_date=${endDate}`;
                const archiveUrl = `${config.api.weather.archive}?latitude=${loc.lat}&longitude=${loc.lon}&${commonParams}&start_date=${histStartDate}&end_date=${histEndDate}`;
                
                try {
                    const [forecastRes, archiveRes] = await Promise.all([
                        fetch(forecastUrl).then(res => res.json()),
                        fetch(archiveUrl).then(res => res.json())
                    ]);

                    // è™•ç†æ•¸æ“š
                    appState.weatherByLocation[name] = {
                        forecast: forecastRes.daily,
                        historical: archiveRes.daily,
                        dateTypes: {} // å„²å­˜æ¯å¤©çš„æ•¸æ“šé¡å‹
                    };
                    
                    // è—åœ– 2.3.4 (æ ¸å¿ƒå‡ç´š): åˆä½µè³‡æ–™
                    // 1. å„ªå…ˆä½¿ç”¨é å ±
                    if (forecastRes.daily && forecastRes.daily.time) {
                        forecastRes.daily.time.forEach(date => {
                            appState.weatherByLocation[name].dateTypes[date] = 'forecast';
                        });
                    }
                    
                    // 2. å¡«å……æ­·å²è³‡æ–™ (FIX: å°å…¥æ¨¡æ“¬æ™‚ç©ºé‚è¼¯)
                    tripData.itinerary.forEach(day => {
                        if (day.location === name) {
                            const dayDate = new Date(day.date + 'T00:00:00');
                            const daysDiff = (dayDate - simToday) / (1000 * 60 * 60 * 24);

                            if (appState.weatherByLocation[name].dateTypes[day.date]) {
                                // é å ± API å·²æä¾›æ•¸æ“š (ä¾‹å¦‚ simToday æ¥è¿‘ real today)
                                // æˆ‘å€‘ç›¸ä¿¡ 'forecast'
                            } else if (daysDiff >= 0 && daysDiff < 16) {
                                // æ¨¡æ“¬æ™‚ç©ºé‚è¼¯:
                                // é€™å¤©åœ¨æ¨¡æ“¬çš„ 16 å¤©é å ±å…§ã€‚
                                // é å ± API å¤±æ•—æ˜¯å› ç‚º real today å¤ªæ—©ã€‚
                                // æˆ‘å€‘ä½¿ç”¨æ­·å²æ•¸æ“šï¼Œä½†æ¨™è¨˜ç‚º 'simulated_forecast' (ä¸é¡¯ç¤º *)
                                appState.weatherByLocation[name].dateTypes[day.date] = 'simulated_forecast';
                            } else {
                                // æ—¥æœŸåœ¨ 16 å¤©å¤–ï¼Œæˆ–çœŸçš„æ²’æœ‰é å ±ï¼Œå›é€€åˆ° 'historical' (é¡¯ç¤º *)
                                appState.weatherByLocation[name].dateTypes[day.date] = 'historical';
                            }
                        }
                    });
                } catch (error) {
                    console.error(`Error fetching weather for ${name}:`, error);
                    appState.weatherByLocation[name] = { forecast: null, historical: null, dateTypes: {} };
                }
            }

            // æ•¸æ“šæº–å‚™å¥½å¾Œï¼Œæ›´æ–°ä¸»é  UI
            updateAllWeatherUI();
        }

        /**
         * æ›´æ–°ä¸»é ä¸Šæ‰€æœ‰å¡ç‰‡çš„å¤©æ°£
         */
        function updateAllWeatherUI() {
            const cards = $$('#itinerary-view .card');
            cards.forEach((card, index) => {
                if (index < tripData.itinerary.length) { // ç¢ºä¿ç´¢å¼•åœ¨ç¯„åœå…§
                    const day = tripData.itinerary[index];
                    const container = card.querySelector('.weather-container');
                    updateWeatherUI(day.location, day.date, container);
                }
            });
        }

        /**
         * è—åœ– 2.3.4 (é—œéµ): æ›´æ–°å–®å€‹å¤©æ°£ UI (è™•ç†æ··åˆé‚è¼¯)
         * @param {string} locationName
         * @param {string} date (YYYY-MM-DD)
         * @param {HTMLElement} container
         */
        function updateWeatherUI(locationName, date, container) {
            if (!container) return;
            
            const locationWeatherData = appState.weatherByLocation[locationName];
            if (!locationWeatherData) {
                container.innerHTML = 'N/A';
                return;
            }

            const dataType = locationWeatherData.dateTypes[date]; // 'forecast', 'simulated_forecast', or 'historical'
            if (!dataType) {
                // console.warn(`No data type found for ${locationName} on ${date}`);
                container.innerHTML = 'N/A';
                return;
            }

            // FIX: 'simulated_forecast' ä¹Ÿä½¿ç”¨ 'historical' æ•¸æ“šé›†
            const dataSet = (dataType === 'forecast') 
                ? locationWeatherData.forecast 
                : locationWeatherData.historical; 

            if (!dataSet || !dataSet.time) {
                // console.warn(`No dataSet found for type ${dataType}`);
                container.innerHTML = 'N/A';
                return;
            }

            // è—åœ– 2.3.4 (é—œéµ: æ—¥æœŸåŒ¹é…)
            // FIX: 'forecast' ç”¨ YYYY-MM-DD, å…¶ä»–ç”¨ MM-DD
            const dateToFind = (dataType === 'forecast') ? date : date.substring(5);
            
            const index = dataSet.time.findIndex(t => 
                (dataType === 'forecast' ? t === dateToFind : t.substring(5) === dateToFind)
            );

            if (index === -1) {
                // console.warn(`Date ${dateToFind} not found in dataSet (type: ${dataType})`);
                container.innerHTML = 'N/A';
                return;
            }

            const icon = getWeatherIcon(dataSet.weather_code[index]);
            const maxTemp = Math.round(dataSet.temperature_2m_max[index]);
            const minTemp = Math.round(dataSet.temperature_2m_min[index]);
            
            // è—åœ– 2.3.4 (é—œéµ: æº«åº¦é¡¯ç¤º)
            // FIX: åªæœ‰ 'historical' æ‰é¡¯ç¤º *
            container.innerHTML = `
                <div class="text-right">
                    <div class="text-2xl">${icon}</div>
                    <div class="text-xs text-gray-400">${minTemp}Â°/${maxTemp}Â° ${dataType === 'historical' ? '*' : ''}</div>
                </div>
            `;
        }

        // ==========================================================
        // åŠŸèƒ½ 4: AI ç¾é£Ÿå»ºè­° (åš´æ ¼éµå¾ªè—åœ– 2.3.4)
        // ==========================================================
        
        async function fetchAiFoodieSuggestion() {
            if (!config.api.gemini.apiKey) {
                $('#ai-status-text').textContent = "éŒ¯èª¤ï¼šGemini API Key æœªåœ¨ config ä¸­è¨­å®šã€‚";
                return;
            }
            
            const geminiButton = $('#gemini-button');
            const aiStatusText = $('#ai-status-text');
            const aiFoodieList = $('#ai-foodie-list');

            // è¨­ç½®åŠ è¼‰ä¸­
            geminiButton.innerHTML = '<div class="gemini-loader"></div>';
            geminiButton.disabled = true;
            aiStatusText.textContent = "AI æ­£åœ¨æ€è€ƒä¸­ï¼Œè«‹ç¨å€™...";
            aiFoodieList.innerHTML = '';

            try {
                // è—åœ– 2.3.4 (åŠŸèƒ½ 4): æº–å‚™ Prompt
                // 1. è®€å–ç¾æœ‰æ¸…å–®
                const existingNames = tripData.foodieList.map(f => f.name);
                const existingTags = [...new Set(tripData.foodieList.map(f => f.tag))];
                
                // 2. åˆ¤æ–·ä»Šå¤©æ—¥æœŸï¼Œæ‰¾å‡º targetRegion
                const today = config.simulationDate; // ä½¿ç”¨ config ä¸­çš„æ—¥æœŸ
                const todayStr = today.toISOString().split('T')[0];
                const todayItinerary = tripData.itinerary.find(d => d.date === todayStr);
                const targetRegion = todayItinerary ? todayItinerary.location : "ç¦å²¡";
                
                const prompt = `
æ‚¨æ˜¯ä¸€ä½å°ˆæ¥­çš„æ—¥æœ¬ç¦å²¡ç¾é£Ÿå°éŠã€‚
æˆ‘ç›®å‰çš„æ—…è¡Œåœ°é»åœ¨ã€Œ${targetRegion}ã€ã€‚
æˆ‘å°ã€Œ${existingTags.join('ã€')}ã€é€™é¡ç¾é£Ÿæ„Ÿèˆˆè¶£ã€‚
è«‹æ¨è–¦ 3 é–“ä½æ–¼ã€Œ${targetRegion}ã€é™„è¿‘ã€é«˜è©•åƒ¹ä¸”é©åˆéŠå®¢çš„ç¾é£Ÿé¤å»³ã€‚

é™åˆ¶ï¼š
1. **[é—œéµ]** è«‹çµ•å°ä¸è¦æ¨è–¦æˆ‘å·²ç¶“çŸ¥é“çš„é¤å»³ï¼Œæˆ‘çš„å·²çŸ¥æ¸…å–®å¦‚ä¸‹ï¼š[${existingNames.join(', ')}]ã€‚
2. è«‹ä»¥ç¹é«”ä¸­æ–‡å›ç­”ã€‚
3. å¿…é ˆä»¥ application/json æ ¼å¼å›å‚³ä¸€å€‹é™£åˆ—ï¼Œé™£åˆ—ä¸­åŒ…å« 3 å€‹ç‰©ä»¶ã€‚
4. æ¯å€‹ç‰©ä»¶å¿…é ˆåŒ…å«ä»¥ä¸‹éµï¼š
   - "name": "é¤å»³åç¨± (æ—¥æ–‡æˆ–ä¸­æ–‡)"
   - "region": "${targetRegion}"
   - "tag": "ç¾é£Ÿé¡å‹ (ä¾‹å¦‚ï¼šæ‹‰éºµã€å£½å¸ã€å±…é…’å±‹)"
   - "googleMapsQuery": "ç”¨æ–¼ Google Maps æœå°‹çš„ç²¾ç¢ºé—œéµå­— (ä¾‹å¦‚ï¼šåšå¤šä¸€å¹¸èˆ åšå¤šæœ¬åº—)"
`;
                
                // è—åœ– 2.3.4 (BUG ä¿®æ­£): API payload è¦æ ¼
                const payload = {
                    contents: [{ parts: [{ text: prompt }] }],
                    generationConfig: {
                        responseMimeType: "application/json",
                        temperature: 0.7
                    }
                };

                // 3. ç™¼é€ API
                const response = await fetch(`${config.api.gemini.url}?key=${config.api.gemini.apiKey}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                if (!response.ok) {
                    throw new Error(`Gemini API Error: ${response.statusText}`);
                }

                const result = await response.json();
                
                if (!result.candidates || !result.candidates[0].content || !result.candidates[0].content.parts[0].text) {
                     throw new Error("Invalid Gemini API response structure.");
                }

                const aiResponseText = result.candidates[0].content.parts[0].text;
                const suggestions = JSON.parse(aiResponseText);
                
                // 4. æ¸²æŸ“çµæœ
                if (suggestions && suggestions.length > 0) {
                    aiStatusText.textContent = `AI ç‚ºæ‚¨åœ¨ã€Œ${targetRegion}ã€æ¨è–¦äº† ${suggestions.length} é …ç¾é£Ÿï¼š`;
                    suggestions.forEach(item => {
                        // è£œä¸Š mapLink ä»¥ä¾¿ createFoodieCard ä½¿ç”¨
                        item.mapLink = `https://maps.google.com/maps?q=${encodeURIComponent(item.googleMapsQuery || item.name)}`;
                        const card = createFoodieCard(item, true); // æ¨™è¨˜ç‚º AI
                        aiFoodieList.appendChild(card);
                    });
                } else {
                    aiStatusText.textContent = "AI æ²’æœ‰å›å‚³å»ºè­°ã€‚";
                }

            } catch (error) {
                console.error("AI Foodie Error:", error);
                aiStatusText.textContent = `AI æ¨è–¦å¤±æ•—ï¼š${error.message}`;
            } finally {
                // æ¢å¾©æŒ‰éˆ•
                geminiButton.innerHTML = getIconSvg('sparkles', { classes: 'w-6 h-6 text-indigo-300' });
                geminiButton.disabled = false;
            }
        }

        // ==========================================================
        // åˆå§‹åŒ–
        // ==========================================================

        document.addEventListener('DOMContentLoaded', () => {
            // è¨­ç½® App æ¨™é¡Œ
            $('#app-title').textContent = tripData.tripTitle;

            // ç¶å®šå°è¦½åˆ—æŒ‰éˆ•
            $$('.nav-button').forEach(button => {
                button.addEventListener('click', () => {
                    switchView(button.dataset.view);
                });
                
                // æ’å…¥å°è¦½åˆ—åœ–ç¤º
                const iconName = {
                    'itinerary-view': 'calendar-days',
                    'foodie-view': 'utensils',
                    'coupon-view': 'ticket'
                }[button.dataset.view];
                button.querySelector('.icon-container').innerHTML = getIconSvg(iconName, { classes: 'w-full h-full' });
            });

            // ç¶å®š AI ç¾é£ŸæŒ‰éˆ•
            const geminiButton = $('#gemini-button');
            geminiButton.innerHTML = getIconSvg('sparkles', { classes: 'w-6 h-6 text-indigo-300' });
            geminiButton.addEventListener('click', fetchAiFoodieSuggestion);
            if (!config.api.gemini.apiKey) {
                geminiButton.disabled = true;
                geminiButton.classList.add('opacity-50', 'cursor-not-allowed');
                $('#ai-status-text').textContent = "æç¤ºï¼šè«‹åœ¨ config ä¸­å¡«å…¥ Gemini API Key ä»¥å•Ÿç”¨ AI ç¾é£Ÿæ¨è–¦ã€‚";
            }
            
            // ç¶å®šå½ˆçª—é—œé–‰
            $('#modal-close-button').addEventListener('click', () => {
                $('#coupon-modal').classList.add('hidden');
                $('#modal-image').src = ''; // æ¸…ç©º
            });
            $('#coupon-modal').addEventListener('click', (e) => {
                if (e.target.id === 'coupon-modal') {
                    $('#coupon-modal').classList.add('hidden');
                    $('#modal-image').src = ''; // æ¸…ç©º
                }
            });

            // æ¸²æŸ“åˆå§‹é é¢
            renderItinerary();
            renderFoodieList();
            renderCoupons();
            
            // ç•°æ­¥ç²å–å¤©æ°£
            fetchAllWeatherData();
        });

    </script>
</body>
</html>
